var C=Object.defineProperty,O=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var g=(o,e,t)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,x=(o,e)=>{for(var t in e||(e={}))B.call(e,t)&&g(o,t,e[t]);if(m)for(var t of m(e))M.call(e,t)&&g(o,t,e[t]);return o},f=(o,e)=>O(o,T(e));import"./modulepreload-polyfill.9d8db203.js";import{s as R,ae as y,j as d,B as h,af as A,b as p,x as E,v as F,ag as N,i as P,G as b,ah as $,ai as z,y as G,z as H,C as L,R as U,a as V}from"./vendor.96b1bcce.js";import{a as Y,S as q}from"./buttons.9b6fafe1.js";import{I as v,U as J,A as K}from"./snackbar.978d4283.js";import{N as Q}from"./nodetree.fc3a4e5d.js";function D(o,e){return e.secret?!0:e.father_id>0?D(o,o.id2node(e.father_id)):!1}class W extends R.exports.Component{constructor(e){super(e);this.state={nodetree:new Q([]),expanded:[]}}async componentDidMount(){let e=await v.get.nodetree();this.setState({nodetree:this.state.nodetree.update_rawinfo(e,J.node_id),expanded:Object.values(e).map(t=>t[1])})}move_node(e,t,r){let a=this.state.nodetree.deepcopy(),i=e.idx_in_father,l=a.id2node(e.father_id);t=a.id2node(t.my_id),e=a.id2node(e.my_id),l.my_id==t.my_id&&i<r&&r--;let c=l.sons;l.sons=[...c.slice(0,i),...c.slice(i+1,c.length)];let n=t.sons;t.sons=[...n.slice(0,r),e,...n.slice(r,n.length)],e.father_id=t.my_id,this.setState({nodetree:a})}DroppableSpace(e){let t=this,r=e.node,a=e.expect_idx,i=this.state.nodetree;const[{is_over_can_drop:l},c]=y(()=>({accept:"treeitem",drop:(n,u)=>{!u.isOver({shallow:!0})||t.move_node(n,r,a)},collect:n=>({is_over_can_drop:n.isOver({shallow:!0})&&n.canDrop()}),canDrop:n=>r.my_id!=n.my_id&&!i.is_son(n.my_id,r.my_id)}));return d(h,{ref:c,sx:{border:l?"1px dashed grey":"0",height:"6px"}})}DragableTreeItem(e){let t=this,r=e.node,a=r.my_id,i=r.father_id,l=e.idx_in_father,c=this.state.nodetree,n=this.DroppableSpace.bind(this),u=D(this.state.nodetree,r);const[{is_dragging:I},j]=A(()=>({type:"treeitem",item:f(x({},r),{idx_in_father:l}),collect:s=>({is_dragging:s.isDragging()})})),[{is_over:S,can_drop:k},w]=y(()=>({accept:"treeitem",drop:(s,_)=>{!_.isOver({shallow:!0})||s.my_id!=r.my_id&&t.move_node(s,r,r.sons.length)},collect:s=>({is_over:s.isOver({shallow:!0}),can_drop:s.canDrop()}),canDrop:s=>r.my_id==s.my_id||!c.is_son(s.my_id,r.my_id)}));return p(h,{ref:w,sx:{border:S&&k?"1px dashed grey":"0"},children:[d(n,{node:c.id2node(i),expect_idx:l}),p(E,{label:d(h,{color:u?"text.secondary":"text.primary",children:p(K,{force_direction:"row",children:[p(F,{sx:{marginY:"auto"},children:["node-",a]}),d(N,{onClick:s=>{s.stopPropagation()},defaultChecked:r.secret,onChange:s=>{let _=this.state.nodetree.deepcopy();_.id2node(a).secret=s.target.checked,this.setState({nodetree:_})}})]})}),nodeId:`${a}`,ref:j,onFocusCapture:s=>s.stopPropagation(),sx:{cursor:"move",opacity:I?.5:1},children:[e.children,d(n,{node:r,expect_idx:r.sons.length})]})]})}get_subtree(e){let t=this,r=this.DragableTreeItem.bind(this);return d(P,{children:Object.values(e.sons).map((a,i)=>d(r,{node:a,idx_in_father:i,children:t.get_subtree(a)},`${i}`))})}async save_nodetree(){return await v.post.nodetree({nodetree:this.state.nodetree.get_raw()})}render(){let e=this,t=this.state.nodetree;return p(h,{sx:{position:"absolute",top:"2%",left:"2%",height:"96%",width:"96%",display:"flex"},children:[d(Y,{sx:{marginRight:"1%"},children:d(q,{save_func:e.save_nodetree.bind(e)})}),p(h,{sx:{position:"relative",width:"100%",flex:1},children:[d(b,{}),d($,{backend:z,children:d(G,{expanded:Object.values(e.state.expanded).map(r=>`${r}`),onNodeToggle:(r,a)=>{e.setState({expanded:a})},defaultCollapseIcon:d(H,{}),defaultExpandIcon:d(L,{}),children:e.get_subtree(t.get_root())})}),d(b,{})]})]})}}U.render(d(V.StrictMode,{children:d(W,{})}),document.getElementById("root"));
