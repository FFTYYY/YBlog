var O=Object.defineProperty,w=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var u=(o,e,t)=>e in o?O(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,g=(o,e)=>{for(var t in e||(e={}))R.call(e,t)&&u(o,t,e[t]);if(m)for(var t of m(e))B.call(e,t)&&u(o,t,e[t]);return o},x=(o,e)=>w(o,T(e));import"./modulepreload-polyfill.9d8db203.js";import{r as C,ab as y,j as d,B as p,ac as M,b as _,s as F,m as $,v as b,ad as E,ae as N,t as k,u as P,C as A,R as H,a as L}from"./vendor.7620ad78.js";import{I as f,R as V,F as q,S as z}from"./buttons.956eb144.js";import{N as G}from"./nodetree.bff3fd0f.js";class J extends C.exports.Component{constructor(e){super(e);this.state={nodetree:new G([]),expanded:[]}}async componentDidMount(){let e=await f.get.nodetree();this.setState({nodetree:this.state.nodetree.update_rawinfo(e,V()),expanded:Object.values(e).map(t=>t[1])})}move_node(e,t,r){let s=this.state.nodetree.deepcopy(),i=e.idx_in_father,l=s.id2node(e.father_id);t=s.id2node(t.my_id),e=s.id2node(e.my_id),l.my_id==t.my_id&&i<r&&r--;let c=l.sons;l.sons=[...c.slice(0,i),...c.slice(i+1,c.length)];let n=t.sons;t.sons=[...n.slice(0,r),e,...n.slice(r,n.length)],e.father_id=t.my_id,this.setState({nodetree:s})}DroppableSpace(e){let t=this,r=e.node,s=e.expect_idx,i=this.state.nodetree;const[{is_over_can_drop:l},c]=y(()=>({accept:"treeitem",drop:(n,h)=>{!h.isOver({shallow:!0})||t.move_node(n,r,s)},collect:n=>({is_over_can_drop:n.isOver({shallow:!0})&&n.canDrop()}),canDrop:n=>r.my_id!=n.my_id&&!i.is_son(n.my_id,r.my_id)}));return d(p,{ref:c,sx:{border:l?"1px dashed grey":"0",height:"6px"}})}DragableTreeItem(e){let t=this,r=e.node,s=r.my_id,i=r.father_id,l=e.idx_in_father,c=this.state.nodetree,n=this.DroppableSpace.bind(this);const[{is_dragging:h},v]=M(()=>({type:"treeitem",item:x(g({},r),{idx_in_father:l}),collect:a=>({is_dragging:a.isDragging()})})),[{is_over:D,can_drop:I},j]=y(()=>({accept:"treeitem",drop:(a,S)=>{!S.isOver({shallow:!0})||a.my_id!=r.my_id&&t.move_node(a,r,r.sons.length)},collect:a=>({is_over:a.isOver({shallow:!0}),can_drop:a.canDrop()}),canDrop:a=>r.my_id==a.my_id||!c.is_son(a.my_id,r.my_id)}));return _(p,{ref:j,sx:{border:D&&I?"1px dashed grey":"0"},children:[d(n,{node:c.id2node(i),expect_idx:l}),_(F,{label:`node-${s}`,nodeId:`${s}`,ref:v,onFocusCapture:a=>a.stopPropagation(),sx:{cursor:"move",opacity:h?.5:1},children:[e.children,d(n,{node:r,expect_idx:r.sons.length})]})]})}get_subtree(e){let t=this,r=this.DragableTreeItem.bind(this);return d($,{children:Object.values(e.sons).map((s,i)=>d(r,{node:s,idx_in_father:i,children:t.get_subtree(s)},`${i}`))})}async save_nodetree(){return await f.post.nodetree({nodetree:this.state.nodetree.get_raw()})}render(){let e=this,t=this.state.nodetree;return _(p,{sx:{position:"absolute",top:"2%",left:"2%",height:"96%",width:"96%",display:"flex"},children:[d(q,{sx:{marginRight:"1%"},children:d(z,{save_func:e.save_nodetree.bind(e)})}),_(p,{sx:{position:"relative",width:"100%",flex:1},children:[d(b,{}),d(E,{backend:N,children:d(k,{expanded:Object.values(e.state.expanded).map(r=>`${r}`),onNodeToggle:(r,s)=>{e.setState({expanded:s})},defaultCollapseIcon:d(P,{}),defaultExpandIcon:d(A,{}),children:e.get_subtree(t.get_root())})}),d(b,{})]})]})}}H.render(d(L.StrictMode,{children:d(J,{})}),document.getElementById("root"));
