var ue=Object.defineProperty,ce=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var P=(n,e,r)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,A=(n,e)=>{for(var r in e||(e={}))pe.call(e,r)&&P(n,r,e[r]);if(X)for(var r of X(e))he.call(e,r)&&P(n,r,e[r]);return n},D=(n,e)=>ce(n,de(e));var z=(n,e,r)=>(P(n,typeof e!="symbol"?e+"":e,r),r);import{r as T,j as t,b as m,a as c,R as _e}from"./jsx-runtime.71fbd6ab.js";import{g as me,a as fe,s as ge,_ as V,u as xe,b as ye,c as ve,d as Fe,F as be,e as Se,T as ne,f as H,h as C,i as Ee,j as $,k as ie,I as S,B as x,l as F,A as w,P as ze,m as k,n as I,o as O,p as oe,q as M,D as Ce,C as we,r as ae,t as le,v as Y,w as U,L as W,x as Ae,y as G,z as Le,G as Be,E as ke,H as Ie,J as Me,K as Pe}from"./titleword.1efab61d.js";import{s as De,e as $e,w as Ne,E as Te,a as Ve,S as q,b as He,c as K,l as Re,m as N,M as Oe,d as Ue}from"./theme.a93dd434.js";import{F as J,a as Je,S as je}from"./buttons.0773717c.js";import{P as R}from"./snackbar.adfa4a4c.js";function Xe(n){return me("MuiInputAdornment",n)}const Ye=fe("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var Q=Ye,Z;const We=["children","className","component","disablePointerEvents","disableTypography","position","variant"],Ge=(n,e)=>{const{ownerState:r}=n;return[e.root,e[`position${H(r.position)}`],r.disablePointerEvents===!0&&e.disablePointerEvents,e[r.variant]]},qe=n=>{const{classes:e,disablePointerEvents:r,hiddenLabel:l,position:i,size:a,variant:s}=n,o={root:["root",r&&"disablePointerEvents",i&&`position${H(i)}`,s,l&&"hiddenLabel",a&&`size${H(a)}`]};return Fe(o,Xe,e)},Ke=ge("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Ge})(({theme:n,ownerState:e})=>V({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:n.palette.action.active},e.variant==="filled"&&{[`&.${Q.positionStart}&:not(.${Q.hiddenLabel})`]:{marginTop:16}},e.position==="start"&&{marginRight:8},e.position==="end"&&{marginLeft:8},e.disablePointerEvents===!0&&{pointerEvents:"none"})),Qe=T.exports.forwardRef(function(e,r){const l=xe({props:e,name:"MuiInputAdornment"}),{children:i,className:a,component:s="div",disablePointerEvents:o=!1,disableTypography:u=!1,position:g,variant:d}=l,y=ye(l,We),p=ve()||{};let h=d;d&&p.variant,p&&!h&&(h=p.variant);const f=V({},l,{hiddenLabel:p.hiddenLabel,size:p.size,disablePointerEvents:o,position:g,variant:h}),_=qe(f);return t(be.Provider,{value:null,children:t(Ke,V({as:s,ownerState:f,className:Se(_.root,a),ref:r},y,{children:typeof i=="string"&&!u?t(ne,{color:"text.secondary",children:i}):m(T.exports.Fragment,{children:[g==="start"?Z||(Z=t("span",{className:"notranslate",children:"\u200B"})):null,i]})}))})});var ee=Qe,Ze=C(t("path",{d:"m22.25 14.29-.69 1.89L9.2 11.71l2.08-5.66 8.56 3.09c2.1.76 3.18 3.06 2.41 5.15zM1.5 12.14 8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86-.69 1.89zm5.8-1.94c1.49-.72 2.12-2.51 1.41-4C7.99 4.71 6.2 4.08 4.7 4.8c-1.49.71-2.12 2.5-1.4 4 .71 1.49 2.5 2.12 4 1.4z"}),"AirlineSeatFlatAngled"),et=C(t("path",{d:"M6 6.5c.31 0 .7.15.9.56.24.5.02 1.1-.47 1.34-.14.06-.28.1-.43.1-.3 0-.7-.15-.89-.56-.17-.34-.1-.63-.05-.78.05-.14.18-.4.51-.56.14-.06.28-.1.43-.1m6.47 2.11 6.69 2.41c.52.19.93.56 1.15 1.05.22.48.25 1.03.06 1.53l-.01.02-8.59-3.11.7-1.9M10 15.19l4 1.44V17h-4v-1.81M6 4.5c-.44 0-.88.1-1.3.3-1.49.71-2.12 2.5-1.4 4 .51 1.07 1.58 1.7 2.7 1.7.44 0 .88-.1 1.3-.3 1.49-.72 2.12-2.51 1.41-4C8.19 5.13 7.12 4.5 6 4.5zm5.28 1.55L9.2 11.71l12.36 4.47.69-1.89c.77-2.09-.31-4.39-2.41-5.15l-8.56-3.09zm-9.09 4.2-.69 1.89L8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86z"}),"AirlineSeatFlatAngledOutlined"),te=C(t("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41l-2.33-2.35zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"}),"AutoFixHigh"),tt=C(t("path",{d:"M18.41 5.8 17.2 4.59c-.78-.78-2.05-.78-2.83 0l-2.68 2.68L3 15.96V20h4.04l8.74-8.74 2.63-2.63c.79-.78.79-2.05 0-2.83zM6.21 18H5v-1.21l8.66-8.66 1.21 1.21L6.21 18zM11 20l4-4h6v4H11z"}),"DriveFileRenameOutline"),se=C(t("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"}),"DriveFolderUpload"),re=C(t("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4 6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"}),"FileCopy"),rt=C(t("path",{d:"M9.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5.75 8.9 3 23h2.1l1.75-8L9 17v6h2v-7.55L8.95 13.4l.6-3C10.85 12 12.8 13 15 13v-2c-1.85 0-3.45-1-4.35-2.45l-.95-1.6C9.35 6.35 8.7 6 8 6c-.25 0-.5.05-.75.15L2 8.3V13h2V9.65l1.75-.75M13 2v7h3.75v14h1.5V9H22V2h-9zm5.01 6V6.25H14.5v-1.5h3.51V3l2.49 2.5L18.01 8z"}),"FollowTheSigns");let nt={text:n=>t("span",{children:n.children}),inline:n=>t("span",{children:n.children}),paragraph:n=>t("div",{children:n.children}),group:n=>t("div",{children:n.children}),struct:n=>t("div",{children:n.children}),support:n=>t("div",{children:n.children})};function it(n,e){const r=e.normalizeNode;return e.normalizeNode=l=>{let[i,a]=l;if(Ee("initializing")){r(l);return}if(a.length==0){let s=i,o=s.children.length;if(o==0||!$(s.children[0],"support","\u5C0F\u8282\u7EBF")){n.add_nodes(De.makenode(),[0]);return}if(!$(s.children[o-1],"support","\u7AE0\u8282\u7EBF")){n.add_nodes($e.makenode(),[o]);return}}if($(i,"support","\u7AE0\u8282\u7EBF")&&(a.length!=1||a[0]!=e.children.length-1)){n.delete_node_by_path(a);return}r(l)},e}function ot(n,e){const r=e.normalizeNode;let l=(i,a)=>{let s=A({},i),o=!1;for(let u in a)s[u]==null&&(s[u]=a[u],o=!0);for(let u in s)a[u]==null&&(delete s[u],o=!0);for(let u in s)s[u].type=="choice"&&JSON.stringify(s[u].choices)!=JSON.stringify(a[u].choices)&&(s[u]={val:s[u].val,type:"choice",choices:a[u].choices},o=!0);return[s,o]};return e.normalizeNode=i=>{let[a,s]=i;if(ie(a)){let o=a,u=o.type,g=o.name,d=n.core.get_style(u,g);if(d==null){r(i);return}if(o.proxy_info&&o.proxy_info.proxy_name){let p=n.get_proxy(u,o.proxy_info.proxy_name),h=o.proxy_info.proxy_params||{},f=o.parameters||{},[_,v]=l(h,p.get_proxy_parameters({})),[b,E]=l(f,p.get_real_parameters(_)),L=p.merge_params(b,p.fixed_parameters),B=JSON.stringify(b)!=JSON.stringify(L);(v||E||B||B)&&n.set_node(o,{parameters:L,proxy_info:D(A({},o.proxy_info),{proxy_params:_})})}else{let p=o.parameters||{},[h,f]=l(p,d.parameter_prototype);f&&n.set_node(o,{parameters:h})}}r(i)},e}let at=[it,ot];function lt(n,e){for(let r of at)e=r(n,e);return e}function st(n){let[e,r]=c.useState(void 0),[l,i]=c.useState(!1),[a,s]=c.useState(!1);return m(c.Fragment,{children:[t(I,{title:"\u5220\u9664\u8D44\u6E90",icon:we,onClick:async o=>{r(o.currentTarget)}}),t(ae,{anchorEl:e,open:!!e,onClose:o=>r(void 0),anchorOrigin:{vertical:"center",horizontal:"right"},children:t(M,{onClick:async o=>{let u=await S.post.delete_resource(n.resource_id);s(u),i(!0),r(void 0),u&&n.onSuccess&&n.onSuccess()},children:"\u786E\u5B9A\uFF1F"})}),t(R,{info_sucess:"\u5220\u9664\u6210\u529F",info_fail:"\u5220\u9664\u5931\u8D25",open:l,status:a,onClose:()=>{i(!1)}})]})}function ut(n){let[e,r,l]=[n.id,n.name,n.url],[i,a]=c.useState(r),[s,o]=c.useState(!1),[u,g]=c.useState(!1),[d,y]=c.useState(!1),[p,h]=c.useState(!1);T.exports.useEffect(()=>{a(r)},[r]);let f=n.onSuccess||(()=>{});return t(ze,{variant:"outlined",sx:{position:"relative",marginTop:"1rem",marginX:"1rem",marginBottom:"1rem",paddingY:"0.7rem"},children:m(w,{force_direction:"row",children:[t(F,{sx:{flex:1},children:m(w,{children:[t(k,{variant:"standard",label:"name",value:i,fullWidth:!0,onChange:_=>{a(_.target.value)}}),t(k,{variant:"standard",label:"url",value:l,fullWidth:!0,sx:{marginTop:"1rem"},InputProps:{readOnly:!0}})]})}),t(F,{children:m(w,{children:[t(I,{title:"\u66F4\u6539\u8D44\u6E90\u540D",icon:tt,onClick:async _=>{let v={name:i},b=await S.post.manage_recourse(!1,v,e);y(b),o(!0)}}),m("label",{children:[t("input",{type:"file",style:{display:"none"},onChange:async _=>{if(_.target.files.length<=0)h(!1);else{var v=new FormData;v.append("file",_.target.files[0]);let b=await S.post.manage_recourse(!0,v,e);h(b),b&&f()}g(!0)}}),t(I,{title:"\u66FF\u6362\u6587\u4EF6",icon:se,component:"span"})]}),t(st,{resource_id:e,onSuccess:f})]})}),t(R,{info_sucess:"\u4FEE\u6539\u6587\u4EF6\u540D\u6210\u529F",info_fail:"\u4FEE\u6539\u6587\u4EF6\u540D\u5931\u8D25",open:s,status:d,onClose:()=>{o(!1)}}),t(R,{info_sucess:"\u4E0A\u4F20\u6587\u4EF6\u6210\u529F",info_fail:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",open:u,status:p,onClose:()=>{g(!1)}})]})})}class ct extends c.Component{constructor(e){super(e);this.state={resources:[]}}async effect(){let e=await S.get.resources(x.node_id);this.setState({resources:e}),this.forceUpdate()}async componentDidMount(){this.effect()}render(){let e=this;return t(F,{sx:r=>A({},r.printer.typography.body),children:t(w,{force_direction:"column",children:e.state.resources.map((r,l)=>{let[i,a,s]=r;return t(c.Fragment,{children:t(ut,{id:i,name:a,url:s,onSuccess:()=>{e.effect()}})},l)})})})}}function dt(n){let[e,r]=c.useState(!1);return m(c.Fragment,{children:[t(J,{close_item:t(O,{title:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6",children:t(oe,{size:"small",children:t(re,{fontSize:"small",color:"primary"})})}),open_item:t(M,{startIcon:t(re,{}),color:"primary",children:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6"}),onClick:()=>{r(!0)},no_button:!0}),t(Ce,{anchor:"left",open:e,onClose:()=>r(!1),ModalProps:{keepMounted:!1},SlideProps:{onExited:()=>{}},PaperProps:{sx:{width:"40%"}},children:t(ct,{})})]})}function pt(n,e,r){function l(a,s){if(le(a)){for(let d in a.children){let y=a.children[d];if(l(y,[...s,Number(d)]))return!0}return}let o=a.text,u=/([^\$]|^)(\$[^\$]+?\$)([^\$]|$)/.exec(o),g=/\$\$[^\$]+?\$\$/.exec(o);if(u){let d=u,y=d.index+d[1].length,p=d[2],h=d.index+d[1].length+p.length,f=o.slice(0,y),_=o.slice(h,o.length),v=p.slice(1,p.length-1),E=n.proxies.inline[e].makenode();return E.children=[{text:v}],n.delete_node_by_path(s),n.add_nodes([{text:f},E,{text:_}],s),!0}if(g){let d=g,y=d.index,p=d[0],h=d.index+p.length,f=o.slice(0,y),_=o.slice(h,o.length),v=p.slice(2,p.length-2),E=n.proxies.group[r].makenode();E.children=[{text:v}];let L=Y(f),B=Y(_);return n.delete_node_by_path(s),n.add_nodes([L,E,B],s),!0}return!1}let i=0;for(;l(n.get_root(),[]);)if(i++,i>0){console.log("\u592A\u591A\u6570\u5B66...");break}}function ht(n){const[e,r]=c.useState(null),[l,i]=c.useState("\u6570\u5B66-\u884C\u5185"),[a,s]=c.useState("\u6570\u5B66-\u5757");return m(c.Fragment,{children:[t(J,{close_item:t(O,{title:"\u5904\u7406\u6570\u5B66",children:t(oe,{size:"small",children:t(te,{fontSize:"small",color:"primary"})})}),open_item:t(M,{startIcon:t(te,{}),color:"primary",children:"\u5904\u7406\u6570\u5B66"}),onClick:o=>{r(o.currentTarget)},no_button:!0}),t(ae,{open:Boolean(e),anchorEl:e,onClose:()=>{r(void 0)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},sx:{paddingX:"4rem",paddingY:"2rem"},children:m(w,{force_direction:"column",children:[t(k,{label:"\u884C\u5185\u516C\u5F0F\u7684Style\u540D",defaultValue:l,InputProps:{startAdornment:t(ee,{position:"start",children:"$...$ = "})},sx:{marginBottom:"0.5rem",marginTop:"1rem"},onChange:o=>{i(o.target.value)}}),t(k,{label:"\u5757\u7EA7\u516C\u5F0F\u7684Style\u540D",defaultValue:a,InputProps:{startAdornment:t(ee,{position:"start",children:"$$...$$ = "})},sx:{marginY:"0.5rem"},onChange:o=>{s(o.target.value)}}),t(M,{variant:"outlined",sx:{width:"50%",marginX:"auto",marginY:"0.5rem"},onClick:()=>{pt(n.get_editor(),l,a)},children:"\u5F00\u59CB\uFF01"})]})})]})}function j(n){let e=n.Icon;return t(c.Fragment,{children:t(J,{close_item:t(F,{sx:{marginLeft:"0.2rem",marginTop:"0.35rem"},children:t(O,{title:n.title,children:t(W,{underline:"hover",href:n.href,children:t(e,{fontSize:"small",color:"primary"})})})}),open_item:t(F,{sx:{marginLeft:"0.2rem",marginTop:"0.2rem",marginBottom:"0.3rem"},children:t(W,{underline:"hover",href:n.href,children:m(w,{children:[t(e,{fontSize:"small",color:"primary"}),t(ne,{sx:r=>D(A({},r.typography.button),{marginLeft:"0.5rem"}),children:n.title})]})})}),no_button:!0})})}function _t(n){return t(j,{title:"\u540E\u53F0\u9875\u9762",href:U(`/admin/articlezone/node/${x.node_id}/change/`),Icon:rt})}function mt(n){return t(j,{title:"\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:U(`/edit/structure/${x.node_id}`),Icon:Ze})}function ft(n){return t(j,{title:"\uFF08\u6D45\uFF09\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:U(`/edit/shallow_structure/${x.node_id}`),Icon:et})}class gt extends c.Component{constructor(e){super(e);z(this,"core");z(this,"editor_renderers");z(this,"printer_renderers");z(this,"printer_ref");z(this,"editor_ref");z(this,"savebutton_ref");this.core=Ne(new Te([])),this.editor_renderers=Ve(new q(this.core,nt)),this.printer_renderers=He(new q(this.core,Ae)),this.state={editor_proxies:K({inline:{},group:{},struct:{},support:{},abstract:{}})},this.editor_ref=c.createRef(),this.printer_ref=c.createRef(),this.savebutton_ref=c.createRef()}set_proxy_params(e,r){function l(i){if(ie(i)&&i.proxy_info&&i.proxy_info.proxy_name){let s=e.get_proxy(i.type,i.proxy_info.proxy_name).get_proxy_parameters(i.parameters);i.proxy_info.proxy_params=s}if(le(i))for(let a of i.children)l(a)}return l(r),r}async componentDidMount(){let e=K({inline:{},group:{},struct:{},support:{},abstract:{}}),r=await S.get.concept(x.node_id);for(let[s,o,u,g]of r){let d=Ue(o,s,u,g);e[d.get_styletype()][s]=d}this.setState({editor_proxies:e});var l=await S.get.content(x.node_id);for(l=l||Pe("root",{title:{val:"",type:"string"}}),G({initializing:!0});!this.get_editor(););let i=this.get_editor();for(i.replace_nodes(i.get_root(),l.children),i.set_node(i.get_root(),{parameters:l.parameters,hiddens:l.hiddens}),this.editor_ref.current.forceUpdate(),G({initializing:!1});!this.get_printer(););let a=this.get_printer();a.update(l),x.linkto&&x.linkto!="None"&&Re(a,Number(x.linkto))}get_editor(){if(this.editor_ref&&this.editor_ref.current)return this.editor_ref.current.get_editor()}get_printer(){if(this.printer_ref&&this.printer_ref.current)return this.printer_ref.current.get_printer()}get_save_button(){if(this.savebutton_ref&&this.savebutton_ref.current)return this.savebutton_ref.current}async save_content(){let e=this.get_editor();if(e){var r={content:e.get_root()};return await S.post.content(r,x.node_id)}return!1}async post_file(e){var r=new FormData;return r.append("file",e[0]),await S.post.file(r,x.node_id)}update_printer(){let e=this.get_printer(),r=this.get_editor();!(e&&r)||e.update(r.get_root())}extra_buttons(e){let r=this;return t(c.Fragment,{children:t(F,{sx:{marginX:"auto"},children:m("label",{children:[t("input",{type:"file",style:{display:"none"},onChange:l=>{l.target.files.length>0&&r.post_file(l.target.files)}}),t(I,{title:"\u4E0A\u4F20",icon:se,component:"span"})]})})})}mainpart(e){let r=this,l=this.extra_buttons.bind(this);return m(F,{sx:e.sx,children:[t(F,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:t(Le,{ref:r.editor_ref,core:r.core,renderers:r.editor_renderers,proxies:r.state.editor_proxies,theme:N,onFocusChange:()=>{let i=r.get_printer(),a=r.get_editor();i&&a&&a.get_slate().selection&&i.scroll_to(a.get_slate().selection.focus.path)},onUpdate:()=>{},onSave:()=>{r.update_printer();let i=r.get_save_button();i&&i.click()},extra_buttons:t(l,{}),plugin:lt})}),t(F,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:t(Be,{value:{BackendData:x.node_id},children:t(ke,{ref:this.printer_ref,core:this.core,renderers:this.printer_renderers,theme:N})})})]})}render(){let e=this,r=this.mainpart.bind(this);return t(Ie,{theme:Me(N),children:t(F,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:m(Oe,{children:[m(Je,{sx:{marginRight:"1%"},children:[t(je,{ref:e.savebutton_ref,save_func:e.save_content.bind(e)}),t(dt,{}),t(ht,{get_editor:()=>e.get_editor()}),t(_t,{}),t(mt,{}),t(ft,{})]}),t(r,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})})}}_e.render(t(c.StrictMode,{children:t(gt,{})}),document.getElementById("root"));
