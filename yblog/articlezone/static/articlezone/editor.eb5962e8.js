var Te=Object.defineProperty,Re=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var K=(t,e,r)=>e in t?Te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,B=(t,e)=>{for(var r in e||(e={}))He.call(e,r)&&K(t,r,e[r]);if(ce)for(var r of ce(e))Oe.call(e,r)&&K(t,r,e[r]);return t},O=(t,e)=>Re(t,Ve(e));var P=(t,e,r)=>(K(t,typeof e!="symbol"?e+"":e,r),r);import{r as U,j as n,b as x,a as p,R as Ue}from"./jsx-runtime.71fbd6ab.js";import{g as Se,a as Ee,s as w,_ as L,u as ke,b as Pe,c as qe,d as Be,F as We,e as Ie,T as re,f as $,k as ne,h as ie,i as je,l as Xe,j as Je,m as k,n as Ke,o as Y,p as Ae,I as E,B as C,q as z,A as I,P as Ye,r as q,t as W,v as oe,w as Me,x as j,D as Ge,C as Qe,y as De,N as Ze,z as Z,E as de,G as X,L as fe,H as et,J as pe,K as tt,M as rt,O as nt,Q as it,R as ot,S as at}from"./titleword.bede0da8.js";import{s as st,e as lt,w as ut,E as ct,a as dt,S as he,b as ft,c as me,l as pt,m as G,M as ht,d as mt}from"./theme.000a3659.js";import{F as ae,a as _t,S as gt}from"./buttons.a8b45257.js";import{P as ee}from"./snackbar.10a151bd.js";function vt(t){return Se("MuiInputAdornment",t)}const bt=Ee("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var _e=bt,ge;const yt=["children","className","component","disablePointerEvents","disableTypography","position","variant"],xt=(t,e)=>{const{ownerState:r}=t;return[e.root,e[`position${$(r.position)}`],r.disablePointerEvents===!0&&e.disablePointerEvents,e[r.variant]]},Ft=t=>{const{classes:e,disablePointerEvents:r,hiddenLabel:a,position:o,size:s,variant:c}=t,i={root:["root",r&&"disablePointerEvents",o&&`position${$(o)}`,c,a&&"hiddenLabel",s&&`size${$(s)}`]};return Be(i,vt,e)},Ct=w("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:xt})(({theme:t,ownerState:e})=>L({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:t.palette.action.active},e.variant==="filled"&&{[`&.${_e.positionStart}&:not(.${_e.hiddenLabel})`]:{marginTop:16}},e.position==="start"&&{marginRight:8},e.position==="end"&&{marginLeft:8},e.disablePointerEvents===!0&&{pointerEvents:"none"})),$t=U.exports.forwardRef(function(e,r){const a=ke({props:e,name:"MuiInputAdornment"}),{children:o,className:s,component:c="div",disablePointerEvents:i=!1,disableTypography:f=!1,position:u,variant:g}=a,F=Pe(a,yt),d=qe()||{};let h=g;g&&d.variant,d&&!h&&(h=d.variant);const m=L({},a,{hiddenLabel:d.hiddenLabel,size:d.size,disablePointerEvents:i,position:u,variant:h}),b=Ft(m);return n(We.Provider,{value:null,children:n(Ct,L({as:c,ownerState:m,className:Ie(b.root,s),ref:r},F,{children:typeof o=="string"&&!f?n(re,{color:"text.secondary",children:o}):x(U.exports.Fragment,{children:[u==="start"?ge||(ge=n("span",{className:"notranslate",children:"\u200B"})):null,o]})}))})});var ve=$t;function zt(t){return Se("MuiLinearProgress",t)}Ee("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Lt=["className","color","value","valueBuffer","variant"];let A=t=>t,be,ye,xe,Fe,Ce,$e;const te=4,St=ne(be||(be=A`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),Et=ne(ye||(ye=A`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),kt=ne(xe||(xe=A`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),Pt=t=>{const{classes:e,variant:r,color:a}=t,o={root:["root",`color${$(a)}`,r],dashed:["dashed",`dashedColor${$(a)}`],bar1:["bar",`barColor${$(a)}`,(r==="indeterminate"||r==="query")&&"bar1Indeterminate",r==="determinate"&&"bar1Determinate",r==="buffer"&&"bar1Buffer"],bar2:["bar",r!=="buffer"&&`barColor${$(a)}`,r==="buffer"&&`color${$(a)}`,(r==="indeterminate"||r==="query")&&"bar2Indeterminate",r==="buffer"&&"bar2Buffer"]};return Be(o,zt,e)},se=(t,e)=>e==="inherit"?"currentColor":t.palette.mode==="light"?Xe(t.palette[e].main,.62):Je(t.palette[e].main,.5),Bt=w("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[`color${$(r.color)}`],e[r.variant]]}})(({ownerState:t,theme:e})=>L({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:se(e,t.color)},t.color==="inherit"&&t.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},t.variant==="buffer"&&{backgroundColor:"transparent"},t.variant==="query"&&{transform:"rotate(180deg)"})),It=w("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.dashed,e[`dashedColor${$(r.color)}`]]}})(({ownerState:t,theme:e})=>{const r=se(e,t.color);return L({position:"absolute",marginTop:0,height:"100%",width:"100%"},t.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${r} 0%, ${r} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},ie(Fe||(Fe=A`
    animation: ${0} 3s infinite linear;
  `),kt)),At=w("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.bar,e[`barColor${$(r.color)}`],(r.variant==="indeterminate"||r.variant==="query")&&e.bar1Indeterminate,r.variant==="determinate"&&e.bar1Determinate,r.variant==="buffer"&&e.bar1Buffer]}})(({ownerState:t,theme:e})=>L({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:t.color==="inherit"?"currentColor":e.palette[t.color].main},t.variant==="determinate"&&{transition:`transform .${te}s linear`},t.variant==="buffer"&&{zIndex:1,transition:`transform .${te}s linear`}),({ownerState:t})=>(t.variant==="indeterminate"||t.variant==="query")&&ie(Ce||(Ce=A`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),St)),Mt=w("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.bar,e[`barColor${$(r.color)}`],(r.variant==="indeterminate"||r.variant==="query")&&e.bar2Indeterminate,r.variant==="buffer"&&e.bar2Buffer]}})(({ownerState:t,theme:e})=>L({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},t.variant!=="buffer"&&{backgroundColor:t.color==="inherit"?"currentColor":e.palette[t.color].main},t.color==="inherit"&&{opacity:.3},t.variant==="buffer"&&{backgroundColor:se(e,t.color),transition:`transform .${te}s linear`}),({ownerState:t})=>(t.variant==="indeterminate"||t.variant==="query")&&ie($e||($e=A`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),Et)),Dt=U.exports.forwardRef(function(e,r){const a=ke({props:e,name:"MuiLinearProgress"}),{className:o,color:s="primary",value:c,valueBuffer:i,variant:f="indeterminate"}=a,u=Pe(a,Lt),g=L({},a,{color:s,variant:f}),F=Pt(g),d=je(),h={},m={bar1:{},bar2:{}};if((f==="determinate"||f==="buffer")&&c!==void 0){h["aria-valuenow"]=Math.round(c),h["aria-valuemin"]=0,h["aria-valuemax"]=100;let b=c-100;d.direction==="rtl"&&(b=-b),m.bar1.transform=`translateX(${b}%)`}if(f==="buffer"&&i!==void 0){let b=(i||0)-100;d.direction==="rtl"&&(b=-b),m.bar2.transform=`translateX(${b}%)`}return x(Bt,L({className:Ie(F.root,o),ownerState:g,role:"progressbar"},h,{ref:r},u,{children:[f==="buffer"?n(It,{className:F.dashed,ownerState:g}):null,n(At,{className:F.bar1,ownerState:g,style:m.bar1}),f==="determinate"?null:n(Mt,{className:F.bar2,ownerState:g,style:m.bar2})]}))});var Nt=Dt,wt=k([n("circle",{cx:"17",cy:"4.54",r:"2"},"0"),n("path",{d:"M14 17h-2c0 1.65-1.35 3-3 3s-3-1.35-3-3 1.35-3 3-3v-2c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5zm3-3.5h-1.86l1.67-3.67C17.42 8.5 16.44 7 14.96 7h-5.2c-.81 0-1.54.47-1.87 1.2L7.22 10l1.92.53L9.79 9H12l-1.83 4.1c-.6 1.33.39 2.9 1.85 2.9H17v5h2v-5.5c0-1.1-.9-2-2-2z"},"1")],"AccessibleForward"),Tt=k(n("path",{d:"m22.25 14.29-.69 1.89L9.2 11.71l2.08-5.66 8.56 3.09c2.1.76 3.18 3.06 2.41 5.15zM1.5 12.14 8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86-.69 1.89zm5.8-1.94c1.49-.72 2.12-2.51 1.41-4C7.99 4.71 6.2 4.08 4.7 4.8c-1.49.71-2.12 2.5-1.4 4 .71 1.49 2.5 2.12 4 1.4z"}),"AirlineSeatFlatAngled"),Rt=k(n("path",{d:"M6 6.5c.31 0 .7.15.9.56.24.5.02 1.1-.47 1.34-.14.06-.28.1-.43.1-.3 0-.7-.15-.89-.56-.17-.34-.1-.63-.05-.78.05-.14.18-.4.51-.56.14-.06.28-.1.43-.1m6.47 2.11 6.69 2.41c.52.19.93.56 1.15 1.05.22.48.25 1.03.06 1.53l-.01.02-8.59-3.11.7-1.9M10 15.19l4 1.44V17h-4v-1.81M6 4.5c-.44 0-.88.1-1.3.3-1.49.71-2.12 2.5-1.4 4 .51 1.07 1.58 1.7 2.7 1.7.44 0 .88-.1 1.3-.3 1.49-.72 2.12-2.51 1.41-4C8.19 5.13 7.12 4.5 6 4.5zm5.28 1.55L9.2 11.71l12.36 4.47.69-1.89c.77-2.09-.31-4.39-2.41-5.15l-8.56-3.09zm-9.09 4.2-.69 1.89L8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86z"}),"AirlineSeatFlatAngledOutlined"),ze=k(n("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41l-2.33-2.35zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"}),"AutoFixHigh"),Vt=k(n("path",{d:"M18.41 5.8 17.2 4.59c-.78-.78-2.05-.78-2.83 0l-2.68 2.68L3 15.96V20h4.04l8.74-8.74 2.63-2.63c.79-.78.79-2.05 0-2.83zM6.21 18H5v-1.21l8.66-8.66 1.21 1.21L6.21 18zM11 20l4-4h6v4H11z"}),"DriveFileRenameOutline"),Ne=k(n("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"}),"DriveFolderUpload"),Le=k(n("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4 6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"}),"FileCopy"),Ht=k(n("path",{d:"M9.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5.75 8.9 3 23h2.1l1.75-8L9 17v6h2v-7.55L8.95 13.4l.6-3C10.85 12 12.8 13 15 13v-2c-1.85 0-3.45-1-4.35-2.45l-.95-1.6C9.35 6.35 8.7 6 8 6c-.25 0-.5.05-.75.15L2 8.3V13h2V9.65l1.75-.75M13 2v7h3.75v14h1.5V9H22V2h-9zm5.01 6V6.25H14.5v-1.5h3.51V3l2.49 2.5L18.01 8z"}),"FollowTheSigns");let Ot={text:t=>n("span",{children:t.children}),inline:t=>n("span",{children:t.children}),paragraph:t=>n("div",{children:t.children}),group:t=>n("div",{children:t.children}),struct:t=>n("div",{children:t.children}),support:t=>n("div",{children:t.children})};function Ut(t,e){const r=e.normalizeNode;return e.normalizeNode=a=>{let[o,s]=a;if(Ke("initializing")){r(a);return}if(s.length==0){let c=o,i=c.children.length;if(i==0||!Y(c.children[0],"support","\u5C0F\u8282\u7EBF")){t.add_nodes(st.makenode(),[0]);return}if(!Y(c.children[i-1],"support","\u7AE0\u8282\u7EBF")){t.add_nodes(lt.makenode(),[i]);return}}if(Y(o,"support","\u7AE0\u8282\u7EBF")&&(s.length!=1||s[0]!=e.children.length-1)){t.delete_node_by_path(s);return}r(a)},e}function qt(t,e){const r=e.normalizeNode;let a=(o,s,c={})=>{let i=B({},o),f=!1;for(let u in s)i[u]==null&&(i[u]=s[u],f=!0);for(let u in i)s[u]==null&&(delete i[u],f=!0);for(let u in i)i[u].type=="choice"&&JSON.stringify(i[u].choices)!=JSON.stringify(s[u].choices)&&(i[u]={val:i[u].val,type:"choice",choices:s[u].choices},f=!0);for(let u in c)i[u].val!=s[u].val&&(i[u]=O(B({},i[u]),{val:s[u].val}),f=!0);return[i,f]};return e.normalizeNode=o=>{let[s,c]=o;if(Ae(s)){let i=s,f=i.type,u=i.name,g=t.core.get_style(f,u);if(g==null){r(o);return}if(i.proxy_info&&i.proxy_info.proxy_name){let d=t.get_proxy(f,i.proxy_info.proxy_name),h=i.proxy_info.proxy_params||{},m=i.parameters||{},[b,l]=a(h,d.get_proxy_parameters({})),[_,v]=a(m,d.get_real_parameters(b),d.fixed_parameters);(l||v)&&t.set_node(i,{parameters:_,proxy_info:O(B({},i.proxy_info),{proxy_params:b})})}else{let d=i.parameters||{},[h,m]=a(d,g.parameter_prototype);m&&t.set_node(i,{parameters:h})}}r(o)},e}let Wt=[Ut,qt];function jt(t,e){for(let r of Wt)e=r(t,e);return e}function Xt(t){let[e,r]=p.useState(void 0),[a,o]=p.useState(!1),[s,c]=p.useState(!1);return x(p.Fragment,{children:[n(W,{title:"\u5220\u9664\u8D44\u6E90",icon:Qe,onClick:async i=>{r(i.currentTarget)}}),n(De,{anchorEl:e,open:!!e,onClose:i=>r(void 0),anchorOrigin:{vertical:"center",horizontal:"right"},children:n(j,{onClick:async i=>{let f=await E.post.delete_resource(t.resource_id);c(f),o(!0),r(void 0),f&&t.onSuccess&&t.onSuccess()},children:"\u786E\u5B9A\uFF1F"})}),n(ee,{info_sucess:"\u5220\u9664\u6210\u529F",info_fail:"\u5220\u9664\u5931\u8D25",open:a,status:s,onClose:()=>{o(!1)}})]})}function Jt(t){let[e,r,a]=[t.id,t.name,t.url],[o,s]=p.useState(r),[c,i]=p.useState(!1),[f,u]=p.useState(!1),[g,F]=p.useState(!1),[d,h]=p.useState(!1);U.exports.useEffect(()=>{s(r)},[r]);let m=t.onSuccess||(()=>{});return n(Ye,{variant:"outlined",sx:{position:"relative",marginTop:"1rem",marginX:"1rem",marginBottom:"1rem",paddingY:"0.7rem"},children:x(I,{force_direction:"row",children:[n(z,{sx:{flex:1},children:x(I,{children:[n(q,{variant:"standard",label:"name",value:o,fullWidth:!0,onChange:b=>{s(b.target.value)}}),n(q,{variant:"standard",label:"url",value:a,fullWidth:!0,sx:{marginTop:"1rem"},InputProps:{readOnly:!0}})]})}),n(z,{children:x(I,{children:[n(W,{title:"\u66F4\u6539\u8D44\u6E90\u540D",icon:Vt,onClick:async b=>{let l={name:o},_=await E.post.manage_recourse(!1,l,e);F(_),i(!0)}}),x("label",{children:[n("input",{type:"file",style:{display:"none"},onChange:async b=>{if(b.target.files.length<=0)h(!1);else{var l=new FormData;l.append("file",b.target.files[0]);let _=await E.post.manage_recourse(!0,l,e);h(_),_&&m()}u(!0)}}),n(W,{title:"\u66FF\u6362\u6587\u4EF6",icon:Ne,component:"span"})]}),n(Xt,{resource_id:e,onSuccess:m})]})}),n(ee,{info_sucess:"\u4FEE\u6539\u6587\u4EF6\u540D\u6210\u529F",info_fail:"\u4FEE\u6539\u6587\u4EF6\u540D\u5931\u8D25",open:c,status:g,onClose:()=>{i(!1)}}),n(ee,{info_sucess:"\u4E0A\u4F20\u6587\u4EF6\u6210\u529F",info_fail:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",open:f,status:d,onClose:()=>{u(!1)}})]})})}class Kt extends p.Component{constructor(e){super(e);this.state={resources:[]}}async effect(){let e=await E.get.resources(C.node_id);this.setState({resources:e}),this.forceUpdate()}async componentDidMount(){this.effect()}render(){let e=this;return n(z,{sx:r=>B({},r.printer.typography.body),children:n(I,{force_direction:"column",children:e.state.resources.map((r,a)=>{let[o,s,c]=r;return n(p.Fragment,{children:n(Jt,{id:o,name:s,url:c,onSuccess:()=>{e.effect()}})},a)})})})}}function Yt(t){let[e,r]=p.useState(!1);return x(p.Fragment,{children:[n(ae,{close_item:n(oe,{title:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6",children:n(Me,{size:"small",children:n(Le,{fontSize:"small",color:"primary"})})}),open_item:n(j,{startIcon:n(Le,{}),color:"primary",children:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6"}),onClick:()=>{r(!0)},no_button:!0}),n(Ge,{anchor:"left",open:e,onClose:()=>r(!1),ModalProps:{keepMounted:!1},SlideProps:{onExited:()=>{}},PaperProps:{sx:{width:"40%"}},children:n(Kt,{})})]})}async function Q(t){return new Promise(e=>setTimeout(e,t))}async function Gt(t,e,r,a){let o,s,c,i;function f(l,_){if(c&&i||l.type=="group"&&l.proxy_info&&l.proxy_info.proxy_name==r||l.type=="inline"&&l.proxy_info&&l.proxy_info.proxy_name==e)return;if(Z(l)){for(let y in l.children){let T=l.children[y];f(T,[..._,Number(y)])}return}let v=l.text;for(let y=0;y<v.length;y++)if(v[y]=="$"){if(y!=0&&v[y-1]=="\\")continue;if(s=="$"){i={path:_,offset:y+1};return}if(s=="$$"){if(y!=v.length-1&&v[y+1]=="$"){i={path:_,offset:y+2};return}continue}if(s==null){if(y!=v.length-1&&v[y+1]=="$"&&o!="$"){s="$$",c={path:_,offset:y},y++;continue}else if(o!="$$"){s="$",c={path:_,offset:y};continue}}}}function u(l=void 0){return s=void 0,c=void 0,i=void 0,o=l,f(t.get_root(),[]),c&&i?[s,c,i]:[void 0,void 0,void 0]}function g(l,_,v,y,T){let le=!1,ue=!1;if(l.type=="group"&&l.proxy_info&&l.proxy_info.proxy_name==r&&(le=!0),l.type=="inline"&&l.proxy_info&&l.proxy_info.proxy_name==e&&(ue=!0),Z(l)){let N=v;le&&(N=[...N,"$$"]),ue&&(N=[...N,"$"]);for(let H in l.children){let we=l.children[H];if(g(we,[..._,Number(H)],N,Number(H),l.children.length-1-Number(H)))return!0}return!1}let S=l.text,M=-1,R=-1,D=-1,V=-1;return v.length>0&&v[v.length-1]=="$$"&&(y==0&&S.startsWith("$$")&&(M=0,R=2),T==0&&S.endsWith("$$")&&(D=S.length-2,V=S.length)),v.length>0&&v[v.length-1]=="$"&&(y==0&&S.startsWith("$")&&(M=0,R=1),T==0&&S.endsWith("$")&&(D=S.length-1,V=S.length)),M>=0||R>=0||D>=0||V>=0?(D>=0&&de.delete(t.get_slate(),{at:{anchor:{path:_,offset:D},focus:{path:_,offset:V}}}),M>=0&&de.delete(t.get_slate(),{at:{anchor:{path:_,offset:M},focus:{path:_,offset:R}}}),!0):!1}async function F(){let l=0;for(;g(t.get_root(),[],[],0,0)&&l<100;)await Q(10),l++;l>100&&console.log("\u597D\u591A\u5220\u9664...")}let d=100,h=0,m=t.proxies.group[r],b=t.proxies.inline[e];for(;h<d;){let[l,_,v]=u("$$");if(_==null)break;t.wrap_nodes(m.makenode(),_,v,{split:!0}),await Q(10),F(),h++,a()}for(;h<d;){let[l,_,v]=u("$");if(_==null)break;t.wrap_nodes(b.makenode(),_,v,{split:!0}),await Q(10),F(),h++,a()}h>=d&&console.log("\u597D\u591A\u6570\u5B66...")}function Qt(t){const[e,r]=p.useState(null),[a,o]=p.useState("\u6570\u5B66-\u884C\u5185"),[s,c]=p.useState("\u6570\u5B66-\u5757"),[i,f]=p.useState(0),[u,g]=p.useState(!1);let F=()=>{let h=t.get_editor().get_root(),m=Ze.string(h).match(/\$/g);return m?m.length:0};return x(p.Fragment,{children:[n(ae,{close_item:n(oe,{title:"\u5904\u7406\u6570\u5B66",children:n(Me,{size:"small",children:n(ze,{fontSize:"small",color:"primary"})})}),open_item:n(j,{startIcon:n(ze,{}),color:"primary",children:"\u5904\u7406\u6570\u5B66"}),onClick:d=>{r(d.currentTarget)},no_button:!0}),n(De,{open:Boolean(e),anchorEl:e,onClose:()=>{r(void 0)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},sx:{paddingX:"4rem",paddingY:"2rem"},children:x(I,{force_direction:"column",children:[n(q,{label:"\u884C\u5185\u516C\u5F0F\u7684Style\u540D",defaultValue:a,InputProps:{startAdornment:n(ve,{position:"start",children:"$...$ = "})},sx:{marginBottom:"0.5rem",marginTop:"1rem"},onChange:d=>{o(d.target.value)}}),n(q,{label:"\u5757\u7EA7\u516C\u5F0F\u7684Style\u540D",defaultValue:s,InputProps:{startAdornment:n(ve,{position:"start",children:"$$...$$ = "})},sx:{marginY:"0.5rem"},onChange:d=>{c(d.target.value)}}),x(re,{children:["\u8FDB\u5EA6\uFF1A",parseInt(String(i*1e4))/100,"%",u?"\uFF08\u6682\u505C\uFF09":""]}),n(Nt,{variant:"determinate",value:i*100}),n(j,{variant:"outlined",sx:{width:"50%",marginX:"auto",marginY:"0.5rem"},onClick:async()=>{let d=F();g(!1),await Gt(t.get_editor(),a,s,()=>{let h=F(),m=0;d==0?m=1:m=1-h/d,m!=i&&f(m)}),g(!0)},children:"\u5F00\u59CB\uFF01"})]})})]})}function J(t){let e=t.Icon;return n(p.Fragment,{children:n(ae,{close_item:n(z,{sx:{marginLeft:"0.2rem",marginTop:"0.35rem"},children:n(oe,{title:t.title,children:n(fe,{underline:"hover",href:t.href,children:n(e,{fontSize:"small",color:"primary"})})})}),open_item:n(z,{sx:{marginLeft:"0.2rem",marginTop:"0.2rem",marginBottom:"0.3rem"},children:n(fe,{underline:"hover",href:t.href,children:x(I,{children:[n(e,{fontSize:"small",color:"primary"}),n(re,{sx:r=>O(B({},r.typography.button),{marginLeft:"0.5rem"}),children:t.title})]})})}),no_button:!0})})}function Zt(t){return n(J,{title:"\u540E\u53F0\u9875\u9762",href:X(`/admin/articlezone/node/${C.node_id}/change/`),Icon:Ht})}function er(t){return n(J,{title:"\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:X(`/edit/structure/${C.node_id}`),Icon:Tt})}function tr(t){return n(J,{title:"\uFF08\u6D45\uFF09\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:X(`/edit/shallow_structure/${C.node_id}`),Icon:Rt})}function rr(t){return n(J,{title:"\u9884\u89C8\u9875\u9762\uFF08\u6709\u4EC0\u4E48\u5FC5\u8981\u5417\uFF09",href:X(`/view/content/${C.node_id}`),Icon:wt})}class nr extends p.Component{constructor(e){super(e);P(this,"core");P(this,"editor_renderers");P(this,"printer_renderers");P(this,"printer_ref");P(this,"editor_ref");P(this,"savebutton_ref");this.core=ut(new ct([])),this.editor_renderers=dt(new he(this.core,Ot)),this.printer_renderers=ft(new he(this.core,et)),this.state={editor_proxies:me({inline:{},group:{},struct:{},support:{},abstract:{}})},this.editor_ref=p.createRef(),this.printer_ref=p.createRef(),this.savebutton_ref=p.createRef()}set_proxy_params(e,r){function a(o){if(Ae(o)&&o.proxy_info&&o.proxy_info.proxy_name){let c=e.get_proxy(o.type,o.proxy_info.proxy_name).get_proxy_parameters(o.parameters);o.proxy_info.proxy_params=c}if(Z(o))for(let s of o.children)a(s)}return a(r),r}async componentDidMount(){let e=me({inline:{},group:{},struct:{},support:{},abstract:{}}),r=await E.get.concept(C.node_id);for(let[c,i,f,u]of r){let g=mt(i,c,f,u);e[g.get_styletype()][c]=g}this.setState({editor_proxies:e});var a=await E.get.content(C.node_id);for(a=a||at("root",{title:{val:"",type:"string"}}),pe({initializing:!0});!this.get_editor(););let o=this.get_editor();for(o.replace_nodes(o.get_root(),a.children),o.set_node(o.get_root(),{parameters:a.parameters,hiddens:a.hiddens}),this.editor_ref.current.forceUpdate(),pe({initializing:!1});!this.get_printer(););let s=this.get_printer();s.update(a),C.linkto&&C.linkto!="None"&&pt(s,Number(C.linkto))}get_editor(){if(this.editor_ref&&this.editor_ref.current)return this.editor_ref.current.get_editor()}get_printer(){if(this.printer_ref&&this.printer_ref.current)return this.printer_ref.current.get_printer()}get_save_button(){if(this.savebutton_ref&&this.savebutton_ref.current)return this.savebutton_ref.current}async save_content(){let e=this.get_editor();if(e){var r={content:e.get_root()};return await E.post.content(r,C.node_id)}return!1}async post_file(e){var r=new FormData;return r.append("file",e[0]),await E.post.file(r,C.node_id)}update_printer(){let e=this.get_printer(),r=this.get_editor();!(e&&r)||e.update(r.get_root())}extra_buttons(e){let r=this;return n(p.Fragment,{children:n(z,{sx:{marginX:"auto"},children:x("label",{children:[n("input",{type:"file",style:{display:"none"},onChange:a=>{a.target.files.length>0&&r.post_file(a.target.files)}}),n(W,{title:"\u4E0A\u4F20",icon:Ne,component:"span"})]})})})}mainpart(e){let r=this,a=this.extra_buttons.bind(this);return x(z,{sx:e.sx,children:[n(z,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:n(tt,{ref:r.editor_ref,core:r.core,renderers:r.editor_renderers,proxies:r.state.editor_proxies,theme:G,onFocusChange:()=>{let o=r.get_printer(),s=r.get_editor();o&&s&&s.get_slate().selection&&o.scroll_to(s.get_slate().selection.focus.path)},onUpdate:()=>{},onSave:()=>{r.update_printer();let o=r.get_save_button();o&&o.click()},extra_buttons:n(a,{}),plugin:jt})}),n(z,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:n(rt,{value:{BackendData:C.node_id},children:n(nt,{ref:this.printer_ref,core:this.core,renderers:this.printer_renderers,theme:G})})})]})}render(){let e=this,r=this.mainpart.bind(this);return n(it,{theme:ot(G),children:n(z,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:x(ht,{children:[x(_t,{sx:{marginRight:"1%"},children:[n(gt,{ref:e.savebutton_ref,save_func:e.save_content.bind(e)}),n(Yt,{}),n(Qt,{get_editor:()=>e.get_editor()}),n(Zt,{}),n(er,{}),n(tr,{}),n(rr,{})]}),n(r,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})})}}Ue.render(n(p.StrictMode,{children:n(nr,{})}),document.getElementById("root"));
