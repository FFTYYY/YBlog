var j=Object.defineProperty;var g=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var h=(r,e,t)=>e in r?j(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,p=(r,e)=>{for(var t in e||(e={}))B.call(e,t)&&h(r,t,e[t]);if(g)for(var t of g(e))F.call(e,t)&&h(r,t,e[t]);return r};var m=(r,e,t)=>(h(r,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill.9d8db203.js";import{T as d,a as u,b,B as c,j as s,c as P,d as D,R}from"./vendor.95bbe24d.js";import{i as f,E as S,Y as k,P as A,I as _,D as C,a as M}from"./snackbar.7d0cba39.js";import{s as T,e as z,w as I,a as Y,b as O,m as U,c as y}from"./theme.22db001b.js";import{F as q,S as G}from"./buttons.66228103.js";function H(r){const e=r.normalizeNode;return r.normalizeNode=t=>{let[l,a]=t;if(a.length==0){let n=l,o=n.children.length;if(o==0||!f(n.children[0],"support","\u5C0F\u8282\u7EBF")){d.insertNodes(r,T.makenode(),{at:[0]});return}if(!f(n.children[o-1],"support","\u7AE0\u8282\u7EBF")){d.insertNodes(r,z.makenode(),{at:[o]});return}}if(f(l,"support","\u7AE0\u8282\u7EBF")&&(a.length!=1||a[0]!=r.children.length-1)){d.removeNodes(r,{at:a});return}e(t)},r}let J=[H];function K(r){for(let e of J)r=e(r);return r}class L extends u.Component{constructor(e){super(e);m(this,"core");m(this,"printer_ref");this.core=I(new S([],{title:""})),this.state={editor:Y(new k(this.core)),printer:O(new A(this.core))},this.state.editor.slate=K(this.state.editor.slate),this.printer_ref=u.createRef()}async componentDidMount(){let e=this.state.editor,t=this.state.printer,l=await _.get.concept();for(let[n,o,w,x,E]of l){let[i,v,N]=U(o,n,w,x,E);this.core.add_style(i),i.type!="abstract"&&(e.update_renderer(v,i.type,i.name),t.update_renderer(N,i.type,i.name))}this.setState({editor:e,printer:t});var a=await _.get.content();a=a||{children:[],parameters:{}},d.insertNodes(this.state.editor.slate,a.children,{at:[0]}),this.core.update_root({parameters:p(p({},this.core.root.parameters),a.parameters)})}async save_content(){var e={content:this.core.root};return await _.post.content(e)}mainpart(e){let t=this;return b(c,{sx:e.sx,children:[s(c,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:s(C,{editor:t.state.editor,theme:y,onFocusChange:()=>{t.state.editor.slate.selection&&t.printer_ref&&t.printer_ref.current&&t.printer_ref.current.scroll_to(t.state.editor.slate.selection.focus.path)},onUpdate:()=>{console.log(t.core.root)}})}),s(c,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:s(M,{printer:t.state.printer,ref:this.printer_ref,theme:y})})]})}render(){let e=this,t=this.mainpart.bind(this);return s(P,{theme:D(y),children:b(c,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:[s(q,{sx:{marginRight:"1%"},children:s(G,{save_func:e.save_content.bind(e)})}),s(t,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})}}R.render(s(u.StrictMode,{children:s(L,{})}),document.getElementById("root"));
