var ue=Object.defineProperty,ce=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var D=(n,t,r)=>t in n?ue(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,w=(n,t)=>{for(var r in t||(t={}))pe.call(t,r)&&D(n,r,t[r]);if(j)for(var r of j(t))he.call(t,r)&&D(n,r,t[r]);return n},L=(n,t)=>ce(n,de(t));var S=(n,t,r)=>(D(n,typeof t!="symbol"?t+"":t,r),r);import{r as T,j as e,b as f,a as c,R as _e}from"./jsx-runtime.71fbd6ab.js";import{g as me,a as fe,s as ge,_ as V,u as xe,b as ve,c as ye,d as Fe,F as be,e as Ce,T as te,f as H,h as E,i as Ee,j as $,k as re,I as C,B as x,l as F,A,P as ze,m as k,n as B,o as O,p as ne,q as I,D as Se,C as we,r as ie,t as oe,v as J,w as M,L as X,x as Ae,y as Y,z as Le,G as ke,E as Be,H as Ie,J as Me,K as Pe}from"./titleword.3b3d5967.js";import{s as De,e as $e,w as Ne,E as Te,a as Ve,S as W,b as He,c as G,l as Re,m as N,M as Oe,d as Ue}from"./theme.cd9b8b8a.js";import{F as U,a as je,S as Je}from"./buttons.8cdb9c71.js";import{P as R}from"./snackbar.d2140d83.js";function Xe(n){return me("MuiInputAdornment",n)}const Ye=fe("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var q=Ye,K;const We=["children","className","component","disablePointerEvents","disableTypography","position","variant"],Ge=(n,t)=>{const{ownerState:r}=n;return[t.root,t[`position${H(r.position)}`],r.disablePointerEvents===!0&&t.disablePointerEvents,t[r.variant]]},qe=n=>{const{classes:t,disablePointerEvents:r,hiddenLabel:l,position:o,size:a,variant:u}=n,i={root:["root",r&&"disablePointerEvents",o&&`position${H(o)}`,u,l&&"hiddenLabel",a&&`size${H(a)}`]};return Fe(i,Xe,t)},Ke=ge("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Ge})(({theme:n,ownerState:t})=>V({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:n.palette.action.active},t.variant==="filled"&&{[`&.${q.positionStart}&:not(.${q.hiddenLabel})`]:{marginTop:16}},t.position==="start"&&{marginRight:8},t.position==="end"&&{marginLeft:8},t.disablePointerEvents===!0&&{pointerEvents:"none"})),Qe=T.exports.forwardRef(function(t,r){const l=xe({props:t,name:"MuiInputAdornment"}),{children:o,className:a,component:u="div",disablePointerEvents:i=!1,disableTypography:h=!1,position:s,variant:d}=l,v=ve(l,We),p=ye()||{};let _=d;d&&p.variant,p&&!_&&(_=p.variant);const g=V({},l,{hiddenLabel:p.hiddenLabel,size:p.size,disablePointerEvents:i,position:s,variant:_}),m=qe(g);return e(be.Provider,{value:null,children:e(Ke,V({as:u,ownerState:g,className:Ce(m.root,a),ref:r},v,{children:typeof o=="string"&&!h?e(te,{color:"text.secondary",children:o}):f(T.exports.Fragment,{children:[s==="start"?K||(K=e("span",{className:"notranslate",children:"\u200B"})):null,o]})}))})});var Q=Qe,Ze=E([e("circle",{cx:"17",cy:"4.54",r:"2"},"0"),e("path",{d:"M14 17h-2c0 1.65-1.35 3-3 3s-3-1.35-3-3 1.35-3 3-3v-2c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5zm3-3.5h-1.86l1.67-3.67C17.42 8.5 16.44 7 14.96 7h-5.2c-.81 0-1.54.47-1.87 1.2L7.22 10l1.92.53L9.79 9H12l-1.83 4.1c-.6 1.33.39 2.9 1.85 2.9H17v5h2v-5.5c0-1.1-.9-2-2-2z"},"1")],"AccessibleForward"),et=E(e("path",{d:"m22.25 14.29-.69 1.89L9.2 11.71l2.08-5.66 8.56 3.09c2.1.76 3.18 3.06 2.41 5.15zM1.5 12.14 8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86-.69 1.89zm5.8-1.94c1.49-.72 2.12-2.51 1.41-4C7.99 4.71 6.2 4.08 4.7 4.8c-1.49.71-2.12 2.5-1.4 4 .71 1.49 2.5 2.12 4 1.4z"}),"AirlineSeatFlatAngled"),tt=E(e("path",{d:"M6 6.5c.31 0 .7.15.9.56.24.5.02 1.1-.47 1.34-.14.06-.28.1-.43.1-.3 0-.7-.15-.89-.56-.17-.34-.1-.63-.05-.78.05-.14.18-.4.51-.56.14-.06.28-.1.43-.1m6.47 2.11 6.69 2.41c.52.19.93.56 1.15 1.05.22.48.25 1.03.06 1.53l-.01.02-8.59-3.11.7-1.9M10 15.19l4 1.44V17h-4v-1.81M6 4.5c-.44 0-.88.1-1.3.3-1.49.71-2.12 2.5-1.4 4 .51 1.07 1.58 1.7 2.7 1.7.44 0 .88-.1 1.3-.3 1.49-.72 2.12-2.51 1.41-4C8.19 5.13 7.12 4.5 6 4.5zm5.28 1.55L9.2 11.71l12.36 4.47.69-1.89c.77-2.09-.31-4.39-2.41-5.15l-8.56-3.09zm-9.09 4.2-.69 1.89L8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86z"}),"AirlineSeatFlatAngledOutlined"),Z=E(e("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41l-2.33-2.35zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"}),"AutoFixHigh"),rt=E(e("path",{d:"M18.41 5.8 17.2 4.59c-.78-.78-2.05-.78-2.83 0l-2.68 2.68L3 15.96V20h4.04l8.74-8.74 2.63-2.63c.79-.78.79-2.05 0-2.83zM6.21 18H5v-1.21l8.66-8.66 1.21 1.21L6.21 18zM11 20l4-4h6v4H11z"}),"DriveFileRenameOutline"),ae=E(e("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"}),"DriveFolderUpload"),ee=E(e("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4 6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"}),"FileCopy"),nt=E(e("path",{d:"M9.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5.75 8.9 3 23h2.1l1.75-8L9 17v6h2v-7.55L8.95 13.4l.6-3C10.85 12 12.8 13 15 13v-2c-1.85 0-3.45-1-4.35-2.45l-.95-1.6C9.35 6.35 8.7 6 8 6c-.25 0-.5.05-.75.15L2 8.3V13h2V9.65l1.75-.75M13 2v7h3.75v14h1.5V9H22V2h-9zm5.01 6V6.25H14.5v-1.5h3.51V3l2.49 2.5L18.01 8z"}),"FollowTheSigns");let it={text:n=>e("span",{children:n.children}),inline:n=>e("span",{children:n.children}),paragraph:n=>e("div",{children:n.children}),group:n=>e("div",{children:n.children}),struct:n=>e("div",{children:n.children}),support:n=>e("div",{children:n.children})};function ot(n,t){const r=t.normalizeNode;return t.normalizeNode=l=>{let[o,a]=l;if(Ee("initializing")){r(l);return}if(a.length==0){let u=o,i=u.children.length;if(i==0||!$(u.children[0],"support","\u5C0F\u8282\u7EBF")){n.add_nodes(De.makenode(),[0]);return}if(!$(u.children[i-1],"support","\u7AE0\u8282\u7EBF")){n.add_nodes($e.makenode(),[i]);return}}if($(o,"support","\u7AE0\u8282\u7EBF")&&(a.length!=1||a[0]!=t.children.length-1)){n.delete_node_by_path(a);return}r(l)},t}function at(n,t){const r=t.normalizeNode;let l=(o,a,u={})=>{let i=w({},o),h=!1;for(let s in a)i[s]==null&&(i[s]=a[s],h=!0);for(let s in i)a[s]==null&&(delete i[s],h=!0);for(let s in i)i[s].type=="choice"&&JSON.stringify(i[s].choices)!=JSON.stringify(a[s].choices)&&(i[s]={val:i[s].val,type:"choice",choices:a[s].choices},h=!0);for(let s in u)i[s].val!=a[s].val&&(i[s]=L(w({},i[s]),{val:a[s].val}),h=!0);return[i,h]};return t.normalizeNode=o=>{let[a,u]=o;if(re(a)){let i=a,h=i.type,s=i.name,d=n.core.get_style(h,s);if(d==null){r(o);return}if(i.proxy_info&&i.proxy_info.proxy_name){let p=n.get_proxy(h,i.proxy_info.proxy_name),_=i.proxy_info.proxy_params||{},g=i.parameters||{},[m,y]=l(_,p.get_proxy_parameters({})),[b,z]=l(g,p.get_real_parameters(m),p.fixed_parameters);(y||z)&&n.set_node(i,{parameters:b,proxy_info:L(w({},i.proxy_info),{proxy_params:m})})}else{let p=i.parameters||{},[_,g]=l(p,d.parameter_prototype);g&&n.set_node(i,{parameters:_})}}r(o)},t}let lt=[ot,at];function st(n,t){for(let r of lt)t=r(n,t);return t}function ut(n){let[t,r]=c.useState(void 0),[l,o]=c.useState(!1),[a,u]=c.useState(!1);return f(c.Fragment,{children:[e(B,{title:"\u5220\u9664\u8D44\u6E90",icon:we,onClick:async i=>{r(i.currentTarget)}}),e(ie,{anchorEl:t,open:!!t,onClose:i=>r(void 0),anchorOrigin:{vertical:"center",horizontal:"right"},children:e(I,{onClick:async i=>{let h=await C.post.delete_resource(n.resource_id);u(h),o(!0),r(void 0),h&&n.onSuccess&&n.onSuccess()},children:"\u786E\u5B9A\uFF1F"})}),e(R,{info_sucess:"\u5220\u9664\u6210\u529F",info_fail:"\u5220\u9664\u5931\u8D25",open:l,status:a,onClose:()=>{o(!1)}})]})}function ct(n){let[t,r,l]=[n.id,n.name,n.url],[o,a]=c.useState(r),[u,i]=c.useState(!1),[h,s]=c.useState(!1),[d,v]=c.useState(!1),[p,_]=c.useState(!1);T.exports.useEffect(()=>{a(r)},[r]);let g=n.onSuccess||(()=>{});return e(ze,{variant:"outlined",sx:{position:"relative",marginTop:"1rem",marginX:"1rem",marginBottom:"1rem",paddingY:"0.7rem"},children:f(A,{force_direction:"row",children:[e(F,{sx:{flex:1},children:f(A,{children:[e(k,{variant:"standard",label:"name",value:o,fullWidth:!0,onChange:m=>{a(m.target.value)}}),e(k,{variant:"standard",label:"url",value:l,fullWidth:!0,sx:{marginTop:"1rem"},InputProps:{readOnly:!0}})]})}),e(F,{children:f(A,{children:[e(B,{title:"\u66F4\u6539\u8D44\u6E90\u540D",icon:rt,onClick:async m=>{let y={name:o},b=await C.post.manage_recourse(!1,y,t);v(b),i(!0)}}),f("label",{children:[e("input",{type:"file",style:{display:"none"},onChange:async m=>{if(m.target.files.length<=0)_(!1);else{var y=new FormData;y.append("file",m.target.files[0]);let b=await C.post.manage_recourse(!0,y,t);_(b),b&&g()}s(!0)}}),e(B,{title:"\u66FF\u6362\u6587\u4EF6",icon:ae,component:"span"})]}),e(ut,{resource_id:t,onSuccess:g})]})}),e(R,{info_sucess:"\u4FEE\u6539\u6587\u4EF6\u540D\u6210\u529F",info_fail:"\u4FEE\u6539\u6587\u4EF6\u540D\u5931\u8D25",open:u,status:d,onClose:()=>{i(!1)}}),e(R,{info_sucess:"\u4E0A\u4F20\u6587\u4EF6\u6210\u529F",info_fail:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",open:h,status:p,onClose:()=>{s(!1)}})]})})}class dt extends c.Component{constructor(t){super(t);this.state={resources:[]}}async effect(){let t=await C.get.resources(x.node_id);this.setState({resources:t}),this.forceUpdate()}async componentDidMount(){this.effect()}render(){let t=this;return e(F,{sx:r=>w({},r.printer.typography.body),children:e(A,{force_direction:"column",children:t.state.resources.map((r,l)=>{let[o,a,u]=r;return e(c.Fragment,{children:e(ct,{id:o,name:a,url:u,onSuccess:()=>{t.effect()}})},l)})})})}}function pt(n){let[t,r]=c.useState(!1);return f(c.Fragment,{children:[e(U,{close_item:e(O,{title:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6",children:e(ne,{size:"small",children:e(ee,{fontSize:"small",color:"primary"})})}),open_item:e(I,{startIcon:e(ee,{}),color:"primary",children:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6"}),onClick:()=>{r(!0)},no_button:!0}),e(Se,{anchor:"left",open:t,onClose:()=>r(!1),ModalProps:{keepMounted:!1},SlideProps:{onExited:()=>{}},PaperProps:{sx:{width:"40%"}},children:e(dt,{})})]})}function ht(n,t,r){function l(a,u){if(oe(a)){for(let d in a.children){let v=a.children[d];if(l(v,[...u,Number(d)]))return!0}return}let i=a.text,h=/([^\$]|^)(\$[^\$]+?\$)([^\$]|$)/.exec(i),s=/\$\$[^\$]+?\$\$/.exec(i);if(h){let d=h,v=d.index+d[1].length,p=d[2],_=d.index+d[1].length+p.length,g=i.slice(0,v),m=i.slice(_,i.length),y=p.slice(1,p.length-1),z=n.proxies.inline[t].makenode();return z.children=[{text:y}],n.delete_node_by_path(u),n.add_nodes([{text:g},z,{text:m}],u),!0}if(s){let d=s,v=d.index,p=d[0],_=d.index+p.length,g=i.slice(0,v),m=i.slice(_,i.length),y=p.slice(2,p.length-2),z=n.proxies.group[r].makenode();z.children=[{text:y}];let le=J(g),se=J(m);return n.delete_node_by_path(u),n.add_nodes([le,z,se],u),!0}return!1}let o=0;for(;l(n.get_root(),[]);)if(o++,o>0){console.log("\u592A\u591A\u6570\u5B66...");break}}function _t(n){const[t,r]=c.useState(null),[l,o]=c.useState("\u6570\u5B66-\u884C\u5185"),[a,u]=c.useState("\u6570\u5B66-\u5757");return f(c.Fragment,{children:[e(U,{close_item:e(O,{title:"\u5904\u7406\u6570\u5B66",children:e(ne,{size:"small",children:e(Z,{fontSize:"small",color:"primary"})})}),open_item:e(I,{startIcon:e(Z,{}),color:"primary",children:"\u5904\u7406\u6570\u5B66"}),onClick:i=>{r(i.currentTarget)},no_button:!0}),e(ie,{open:Boolean(t),anchorEl:t,onClose:()=>{r(void 0)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},sx:{paddingX:"4rem",paddingY:"2rem"},children:f(A,{force_direction:"column",children:[e(k,{label:"\u884C\u5185\u516C\u5F0F\u7684Style\u540D",defaultValue:l,InputProps:{startAdornment:e(Q,{position:"start",children:"$...$ = "})},sx:{marginBottom:"0.5rem",marginTop:"1rem"},onChange:i=>{o(i.target.value)}}),e(k,{label:"\u5757\u7EA7\u516C\u5F0F\u7684Style\u540D",defaultValue:a,InputProps:{startAdornment:e(Q,{position:"start",children:"$$...$$ = "})},sx:{marginY:"0.5rem"},onChange:i=>{u(i.target.value)}}),e(I,{variant:"outlined",sx:{width:"50%",marginX:"auto",marginY:"0.5rem"},onClick:()=>{ht(n.get_editor(),l,a)},children:"\u5F00\u59CB\uFF01"})]})})]})}function P(n){let t=n.Icon;return e(c.Fragment,{children:e(U,{close_item:e(F,{sx:{marginLeft:"0.2rem",marginTop:"0.35rem"},children:e(O,{title:n.title,children:e(X,{underline:"hover",href:n.href,children:e(t,{fontSize:"small",color:"primary"})})})}),open_item:e(F,{sx:{marginLeft:"0.2rem",marginTop:"0.2rem",marginBottom:"0.3rem"},children:e(X,{underline:"hover",href:n.href,children:f(A,{children:[e(t,{fontSize:"small",color:"primary"}),e(te,{sx:r=>L(w({},r.typography.button),{marginLeft:"0.5rem"}),children:n.title})]})})}),no_button:!0})})}function mt(n){return e(P,{title:"\u540E\u53F0\u9875\u9762",href:M(`/admin/articlezone/node/${x.node_id}/change/`),Icon:nt})}function ft(n){return e(P,{title:"\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:M(`/edit/structure/${x.node_id}`),Icon:et})}function gt(n){return e(P,{title:"\uFF08\u6D45\uFF09\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:M(`/edit/shallow_structure/${x.node_id}`),Icon:tt})}function xt(n){return e(P,{title:"\u9884\u89C8\u9875\u9762\uFF08\u6709\u4EC0\u4E48\u5FC5\u8981\u5417\uFF09",href:M(`/view/content/${x.node_id}`),Icon:Ze})}class vt extends c.Component{constructor(t){super(t);S(this,"core");S(this,"editor_renderers");S(this,"printer_renderers");S(this,"printer_ref");S(this,"editor_ref");S(this,"savebutton_ref");this.core=Ne(new Te([])),this.editor_renderers=Ve(new W(this.core,it)),this.printer_renderers=He(new W(this.core,Ae)),this.state={editor_proxies:G({inline:{},group:{},struct:{},support:{},abstract:{}})},this.editor_ref=c.createRef(),this.printer_ref=c.createRef(),this.savebutton_ref=c.createRef()}set_proxy_params(t,r){function l(o){if(re(o)&&o.proxy_info&&o.proxy_info.proxy_name){let u=t.get_proxy(o.type,o.proxy_info.proxy_name).get_proxy_parameters(o.parameters);o.proxy_info.proxy_params=u}if(oe(o))for(let a of o.children)l(a)}return l(r),r}async componentDidMount(){let t=G({inline:{},group:{},struct:{},support:{},abstract:{}}),r=await C.get.concept(x.node_id);for(let[u,i,h,s]of r){let d=Ue(i,u,h,s);t[d.get_styletype()][u]=d}this.setState({editor_proxies:t});var l=await C.get.content(x.node_id);for(l=l||Pe("root",{title:{val:"",type:"string"}}),Y({initializing:!0});!this.get_editor(););let o=this.get_editor();for(o.replace_nodes(o.get_root(),l.children),o.set_node(o.get_root(),{parameters:l.parameters,hiddens:l.hiddens}),this.editor_ref.current.forceUpdate(),Y({initializing:!1});!this.get_printer(););let a=this.get_printer();a.update(l),x.linkto&&x.linkto!="None"&&Re(a,Number(x.linkto))}get_editor(){if(this.editor_ref&&this.editor_ref.current)return this.editor_ref.current.get_editor()}get_printer(){if(this.printer_ref&&this.printer_ref.current)return this.printer_ref.current.get_printer()}get_save_button(){if(this.savebutton_ref&&this.savebutton_ref.current)return this.savebutton_ref.current}async save_content(){let t=this.get_editor();if(t){var r={content:t.get_root()};return await C.post.content(r,x.node_id)}return!1}async post_file(t){var r=new FormData;return r.append("file",t[0]),await C.post.file(r,x.node_id)}update_printer(){let t=this.get_printer(),r=this.get_editor();!(t&&r)||t.update(r.get_root())}extra_buttons(t){let r=this;return e(c.Fragment,{children:e(F,{sx:{marginX:"auto"},children:f("label",{children:[e("input",{type:"file",style:{display:"none"},onChange:l=>{l.target.files.length>0&&r.post_file(l.target.files)}}),e(B,{title:"\u4E0A\u4F20",icon:ae,component:"span"})]})})})}mainpart(t){let r=this,l=this.extra_buttons.bind(this);return f(F,{sx:t.sx,children:[e(F,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:e(Le,{ref:r.editor_ref,core:r.core,renderers:r.editor_renderers,proxies:r.state.editor_proxies,theme:N,onFocusChange:()=>{let o=r.get_printer(),a=r.get_editor();o&&a&&a.get_slate().selection&&o.scroll_to(a.get_slate().selection.focus.path)},onUpdate:()=>{},onSave:()=>{r.update_printer();let o=r.get_save_button();o&&o.click()},extra_buttons:e(l,{}),plugin:st})}),e(F,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:e(ke,{value:{BackendData:x.node_id},children:e(Be,{ref:this.printer_ref,core:this.core,renderers:this.printer_renderers,theme:N})})})]})}render(){let t=this,r=this.mainpart.bind(this);return e(Ie,{theme:Me(N),children:e(F,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:f(Oe,{children:[f(je,{sx:{marginRight:"1%"},children:[e(Je,{ref:t.savebutton_ref,save_func:t.save_content.bind(t)}),e(pt,{}),e(_t,{get_editor:()=>t.get_editor()}),e(mt,{}),e(ft,{}),e(gt,{}),e(xt,{})]}),e(r,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})})}}_e.render(e(c.StrictMode,{children:e(vt,{})}),document.getElementById("root"));
