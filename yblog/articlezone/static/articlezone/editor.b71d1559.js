var oe=Object.defineProperty,ae=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var P=(n,e,t)=>e in n?oe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,w=(n,e)=>{for(var t in e||(e={}))le.call(e,t)&&P(n,t,e[t]);if(R)for(var t of R(e))ue.call(e,t)&&P(n,t,e[t]);return n},H=(n,e)=>ae(n,se(e));var E=(n,e,t)=>(P(n,typeof e!="symbol"?e+"":e,t),t);import{r as L,j as r,b as f,a as d,R as ce}from"./jsx-runtime.71fbd6ab.js";import{g as de,a as pe,s as he,_ as $,u as _e,b as me,c as fe,d as ge,F as xe,e as ye,T as ve,f as N,h as B,i as be,j as I,k as G,I as F,B as b,A as S,P as Fe,l as z,m as A,n as K,o as Q,p as k,D as Ce,C as Ee,q as Z,r as ee,t as O,v as Se,w as U,x as D,y as we,z as ze,E as Ae,G as ke,H as Be}from"./titleword.139e2833.js";import{s as Pe,e as Ie,w as De,E as Me,a as Le,S as V,b as $e,c as j,l as Ne,m as M,M as Te,d as Re}from"./theme.353168bd.js";import{F as te,a as He,S as Oe}from"./buttons.696112df.js";import{P as T}from"./snackbar.ba217997.js";function Ue(n){return de("MuiInputAdornment",n)}const Ve=pe("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var X=Ve,Y;const je=["children","className","component","disablePointerEvents","disableTypography","position","variant"],Xe=(n,e)=>{const{ownerState:t}=n;return[e.root,e[`position${N(t.position)}`],t.disablePointerEvents===!0&&e.disablePointerEvents,e[t.variant]]},Ye=n=>{const{classes:e,disablePointerEvents:t,hiddenLabel:s,position:i,size:a,variant:l}=n,o={root:["root",t&&"disablePointerEvents",i&&`position${N(i)}`,l,s&&"hiddenLabel",a&&`size${N(a)}`]};return ge(o,Ue,e)},Je=he("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Xe})(({theme:n,ownerState:e})=>$({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:n.palette.action.active},e.variant==="filled"&&{[`&.${X.positionStart}&:not(.${X.hiddenLabel})`]:{marginTop:16}},e.position==="start"&&{marginRight:8},e.position==="end"&&{marginLeft:8},e.disablePointerEvents===!0&&{pointerEvents:"none"})),We=L.exports.forwardRef(function(e,t){const s=_e({props:e,name:"MuiInputAdornment"}),{children:i,className:a,component:l="div",disablePointerEvents:o=!1,disableTypography:u=!1,position:g,variant:c}=s,x=me(s,je),p=fe()||{};let h=c;c&&p.variant,p&&!h&&(h=p.variant);const m=$({},s,{hiddenLabel:p.hiddenLabel,size:p.size,disablePointerEvents:o,position:g,variant:h}),_=Ye(m);return r(xe.Provider,{value:null,children:r(Je,$({as:l,ownerState:m,className:ye(_.root,a),ref:t},x,{children:typeof i=="string"&&!u?r(ve,{color:"text.secondary",children:i}):f(L.exports.Fragment,{children:[g==="start"?Y||(Y=r("span",{className:"notranslate",children:"\u200B"})):null,i]})}))})});var J=We,W=B(r("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41l-2.33-2.35zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"}),"AutoFixHigh"),qe=B(r("path",{d:"M18.41 5.8 17.2 4.59c-.78-.78-2.05-.78-2.83 0l-2.68 2.68L3 15.96V20h4.04l8.74-8.74 2.63-2.63c.79-.78.79-2.05 0-2.83zM6.21 18H5v-1.21l8.66-8.66 1.21 1.21L6.21 18zM11 20l4-4h6v4H11z"}),"DriveFileRenameOutline"),re=B(r("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"}),"DriveFolderUpload"),q=B(r("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4 6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"}),"FileCopy");let Ge={text:n=>r("span",{children:n.children}),inline:n=>r("span",{children:n.children}),paragraph:n=>r("div",{children:n.children}),group:n=>r("div",{children:n.children}),struct:n=>r("div",{children:n.children}),support:n=>r("div",{children:n.children})};function Ke(n,e){const t=e.normalizeNode;return e.normalizeNode=s=>{let[i,a]=s;if(be("initializing")){t(s);return}if(a.length==0){let l=i,o=l.children.length;if(o==0||!I(l.children[0],"support","\u5C0F\u8282\u7EBF")){n.add_nodes(Pe.makenode(),[0]);return}if(!I(l.children[o-1],"support","\u7AE0\u8282\u7EBF")){n.add_nodes(Ie.makenode(),[o]);return}}if(I(i,"support","\u7AE0\u8282\u7EBF")&&(a.length!=1||a[0]!=e.children.length-1)){n.delete_node_by_path(a);return}t(s)},e}function Qe(n,e){const t=e.normalizeNode;let s=(i,a)=>{let l=w({},i),o=!1;for(let u in a)l[u]==null&&(l[u]=a[u],o=!0);for(let u in l)a[u]==null&&(delete l[u],o=!0);for(let u in l)l[u].type=="choice"&&JSON.stringify(l[u].choices)!=JSON.stringify(a[u].choices)&&(l[u]={val:l[u].val,type:"choice",choices:a[u].choices},o=!0);return[l,o]};return e.normalizeNode=i=>{let[a,l]=i;if(G(a)){let o=a,u=o.type,g=o.name,c=n.core.get_style(u,g);if(c==null){t(i);return}if(o.proxy_info&&o.proxy_info.proxy_name){let p=n.get_proxy(u,o.proxy_info.proxy_name),h=o.proxy_info.proxy_params||{},m=o.parameters||{},[_,y]=s(h,p.get_proxy_parameters({})),[v,C]=s(m,p.get_real_parameters(_));(y||C)&&n.set_node(o,{parameters:v,proxy_info:H(w({},o.proxy_info),{proxy_params:_})})}else{let p=o.parameters||{},[h,m]=s(p,c.parameter_prototype);m&&n.set_node(o,{parameters:h})}}t(i)},e}let Ze=[Ke,Qe];function et(n,e){for(let t of Ze)e=t(n,e);return e}function tt(n){let[e,t]=d.useState(void 0),[s,i]=d.useState(!1),[a,l]=d.useState(!1);return f(d.Fragment,{children:[r(A,{title:"\u5220\u9664\u8D44\u6E90",icon:Ee,onClick:async o=>{t(o.currentTarget)}}),r(Z,{anchorEl:e,open:!!e,onClose:o=>t(void 0),anchorOrigin:{vertical:"center",horizontal:"right"},children:r(k,{onClick:async o=>{let u=await F.post.delete_resource(n.resource_id);l(u),i(!0),t(void 0),u&&n.onSuccess&&n.onSuccess()},children:"\u786E\u5B9A\uFF1F"})}),r(T,{info_sucess:"\u5220\u9664\u6210\u529F",info_fail:"\u5220\u9664\u5931\u8D25",open:s,status:a,onClose:()=>{i(!1)}})]})}function rt(n){let[e,t,s]=[n.id,n.name,n.url],[i,a]=d.useState(t),[l,o]=d.useState(!1),[u,g]=d.useState(!1),[c,x]=d.useState(!1),[p,h]=d.useState(!1);L.exports.useEffect(()=>{a(t)},[t]);let m=n.onSuccess||(()=>{});return r(Fe,{variant:"outlined",sx:{position:"relative",marginTop:"1rem",marginX:"1rem",marginBottom:"1rem",paddingY:"0.7rem"},children:f(S,{force_direction:"row",children:[r(b,{sx:{flex:1},children:f(S,{children:[r(z,{variant:"standard",label:"name",value:i,fullWidth:!0,onChange:_=>{a(_.target.value)}}),r(z,{variant:"standard",label:"url",value:s,fullWidth:!0,sx:{marginTop:"1rem"},InputProps:{readOnly:!0}})]})}),r(b,{children:f(S,{children:[r(A,{title:"\u66F4\u6539\u8D44\u6E90\u540D",icon:qe,onClick:async _=>{let y={name:i},v=await F.post.manage_recourse(!1,y,e);x(v),o(!0)}}),f("label",{children:[r("input",{type:"file",style:{display:"none"},onChange:async _=>{if(_.target.files.length<=0)h(!1);else{var y=new FormData;y.append("file",_.target.files[0]);let v=await F.post.manage_recourse(!0,y,e);h(v),v&&m()}g(!0)}}),r(A,{title:"\u66FF\u6362\u6587\u4EF6",icon:re,component:"span"})]}),r(tt,{resource_id:e,onSuccess:m})]})}),r(T,{info_sucess:"\u4FEE\u6539\u6587\u4EF6\u540D\u6210\u529F",info_fail:"\u4FEE\u6539\u6587\u4EF6\u540D\u5931\u8D25",open:l,status:c,onClose:()=>{o(!1)}}),r(T,{info_sucess:"\u4E0A\u4F20\u6587\u4EF6\u6210\u529F",info_fail:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",open:u,status:p,onClose:()=>{g(!1)}})]})})}class nt extends d.Component{constructor(e){super(e);this.state={resources:[]}}async effect(){let e=await F.get.resources();this.setState({resources:e}),this.forceUpdate()}async componentDidMount(){this.effect()}render(){let e=this;return r(b,{sx:t=>w({},t.printer.typography.body),children:r(S,{force_direction:"column",children:e.state.resources.map((t,s)=>{let[i,a,l]=t;return r(d.Fragment,{children:r(rt,{id:i,name:a,url:l,onSuccess:()=>{e.effect()}})},s)})})})}}function it(n){let[e,t]=d.useState(!1);return f(d.Fragment,{children:[r(te,{close_item:r(K,{title:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6",children:r(Q,{size:"small",children:r(q,{fontSize:"small",color:"primary"})})}),open_item:r(k,{startIcon:r(q,{}),color:"primary",children:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6"}),onClick:()=>{t(!0)},no_button:!0}),r(Ce,{anchor:"left",open:e,onClose:()=>t(!1),ModalProps:{keepMounted:!1},SlideProps:{onExited:()=>{}},PaperProps:{sx:{width:"40%"}},children:r(nt,{})})]})}function ot(n,e,t){function s(a,l){if(ee(a)){for(let c in a.children){let x=a.children[c];if(s(x,[...l,Number(c)]))return!0}return}let o=a.text,u=/([^\$]|^)(\$[^\$]+?\$)([^\$]|$)/.exec(o),g=/\$\$[^\$]+?\$\$/.exec(o);if(u){let c=u,x=c.index+c[1].length,p=c[2],h=c.index+c[1].length+p.length,m=o.slice(0,x),_=o.slice(h,o.length),y=p.slice(1,p.length-1),C=n.proxies.inline[e].makenode();return C.children=[{text:y}],n.delete_node_by_path(l),n.add_nodes([{text:m},C,{text:_}],l),!0}if(g){let c=g,x=c.index,p=c[0],h=c.index+p.length,m=o.slice(0,x),_=o.slice(h,o.length),y=p.slice(2,p.length-2),C=n.proxies.group[t].makenode();C.children=[{text:y}];let ne=O(m),ie=O(_);return n.delete_node_by_path(l),n.add_nodes([ne,C,ie],l),!0}return!1}let i=0;for(;s(n.get_root(),[]);)if(i++,i>0){console.log("\u592A\u591A\u6570\u5B66...");break}}function at(n){const[e,t]=d.useState(null),[s,i]=d.useState("\u6570\u5B66-\u884C\u5185"),[a,l]=d.useState("\u6570\u5B66-\u5757");return f(d.Fragment,{children:[r(te,{close_item:r(K,{title:"\u5904\u7406\u6570\u5B66",children:r(Q,{size:"small",children:r(W,{fontSize:"small",color:"primary"})})}),open_item:r(k,{startIcon:r(W,{}),color:"primary",children:"\u5904\u7406\u6570\u5B66"}),onClick:o=>{t(o.currentTarget)},no_button:!0}),r(Z,{open:Boolean(e),anchorEl:e,onClose:()=>{t(void 0)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},sx:{paddingX:"4rem",paddingY:"2rem"},children:f(S,{force_direction:"column",children:[r(z,{label:"\u884C\u5185\u516C\u5F0F\u7684Style\u540D",defaultValue:s,InputProps:{startAdornment:r(J,{position:"start",children:"$...$ = "})},sx:{marginBottom:"0.5rem",marginTop:"1rem"},onChange:o=>{i(o.target.value)}}),r(z,{label:"\u5757\u7EA7\u516C\u5F0F\u7684Style\u540D",defaultValue:a,InputProps:{startAdornment:r(J,{position:"start",children:"$$...$$ = "})},sx:{marginY:"0.5rem"},onChange:o=>{l(o.target.value)}}),r(k,{variant:"outlined",sx:{width:"50%",marginX:"auto",marginY:"0.5rem"},onClick:()=>{ot(n.get_editor(),s,a)},children:"\u5F00\u59CB\uFF01"})]})})]})}class st extends d.Component{constructor(e){super(e);E(this,"core");E(this,"editor_renderers");E(this,"printer_renderers");E(this,"printer_ref");E(this,"editor_ref");E(this,"savebutton_ref");this.core=De(new Me([])),this.editor_renderers=Le(new V(this.core,Ge)),this.printer_renderers=$e(new V(this.core,Se)),this.state={editor_proxies:j({inline:{},group:{},struct:{},support:{},abstract:{}})},this.editor_ref=d.createRef(),this.printer_ref=d.createRef(),this.savebutton_ref=d.createRef()}set_proxy_params(e,t){function s(i){if(G(i)&&i.proxy_info&&i.proxy_info.proxy_name){let l=e.get_proxy(i.type,i.proxy_info.proxy_name).get_proxy_parameters(i.parameters);i.proxy_info.proxy_params=l}if(ee(i))for(let a of i.children)s(a)}return s(t),t}async componentDidMount(){let e=j({inline:{},group:{},struct:{},support:{},abstract:{}}),t=await F.get.concept();for(let[l,o,u,g]of t){let c=Re(o,l,u,g);e[c.get_styletype()][l]=c}this.setState({editor_proxies:e});var s=await F.get.content();for(s=s||Be("root",{title:{val:"",type:"string"}}),U({initializing:!0});!this.get_editor(););let i=this.get_editor();for(i.replace_nodes(i.get_root(),s.children),i.set_node(i.get_root(),{parameters:s.parameters,hiddens:s.hiddens}),this.editor_ref.current.forceUpdate(),U({initializing:!1});!this.get_printer(););let a=this.get_printer();a.update(s),D.linkto&&D.linkto!="None"&&Ne(a,Number(D.linkto))}get_editor(){if(this.editor_ref&&this.editor_ref.current)return this.editor_ref.current.get_editor()}get_printer(){if(this.printer_ref&&this.printer_ref.current)return this.printer_ref.current.get_printer()}get_save_button(){if(this.savebutton_ref&&this.savebutton_ref.current)return this.savebutton_ref.current}async save_content(){let e=this.get_editor();if(e){var t={content:e.get_root()};return await F.post.content(t)}return!1}async post_file(e){var t=new FormData;return t.append("file",e[0]),await F.post.file(t)}update_printer(){let e=this.get_printer(),t=this.get_editor();!(e&&t)||e.update(t.get_root())}extra_buttons(e){let t=this;return r(d.Fragment,{children:r(b,{sx:{marginX:"auto"},children:f("label",{children:[r("input",{type:"file",style:{display:"none"},onChange:s=>{s.target.files.length>0&&t.post_file(s.target.files)}}),r(A,{title:"\u4E0A\u4F20",icon:re,component:"span"})]})})})}mainpart(e){let t=this,s=this.extra_buttons.bind(this);return f(b,{sx:e.sx,children:[r(b,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:r(we,{ref:t.editor_ref,core:t.core,renderers:t.editor_renderers,proxies:t.state.editor_proxies,theme:M,onFocusChange:()=>{let i=t.get_printer(),a=t.get_editor();i&&a&&a.get_slate().selection&&i.scroll_to(a.get_slate().selection.focus.path)},onUpdate:()=>{},onSave:()=>{t.update_printer();let i=t.get_save_button();i&&i.click()},extra_buttons:r(s,{}),plugin:et})}),r(b,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:r(ze,{ref:this.printer_ref,core:this.core,renderers:this.printer_renderers,theme:M})})]})}render(){let e=this,t=this.mainpart.bind(this);return r(Ae,{theme:ke(M),children:r(b,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:f(Te,{children:[f(He,{sx:{marginRight:"1%"},children:[r(Oe,{ref:e.savebutton_ref,save_func:e.save_content.bind(e)}),r(it,{}),r(at,{get_editor:()=>e.get_editor()})]}),r(t,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})})}}ce.render(r(d.StrictMode,{children:r(st,{})}),document.getElementById("root"));
