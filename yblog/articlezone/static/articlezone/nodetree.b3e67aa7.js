var O=Object.defineProperty,w=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var u=(o,e,t)=>e in o?O(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,g=(o,e)=>{for(var t in e||(e={}))B.call(e,t)&&u(o,t,e[t]);if(m)for(var t of m(e))C.call(e,t)&&u(o,t,e[t]);return o},x=(o,e)=>w(o,T(e));import"./modulepreload-polyfill.9d8db203.js";import{r as M,ab as b,j as d,B as p,ac as R,b as h,s as k,m as F,v as f,ad as $,ae as E,t as N,u as P,C as A,R as H,a as L}from"./vendor.95bbe24d.js";import{F as Q,S as V}from"./buttons.66228103.js";import{I as y,Q as q}from"./snackbar.7d0cba39.js";import{N as z}from"./nodetree.bff3fd0f.js";class G extends M.exports.Component{constructor(e){super(e);this.state={nodetree:new z([]),expanded:[]}}async componentDidMount(){let e=await y.get.nodetree();this.setState({nodetree:this.state.nodetree.update_rawinfo(e,q.node_id),expanded:Object.values(e).map(t=>t[1])})}move_node(e,t,r){let s=this.state.nodetree.deepcopy(),i=e.idx_in_father,l=s.id2node(e.father_id);t=s.id2node(t.my_id),e=s.id2node(e.my_id),l.my_id==t.my_id&&i<r&&r--;let c=l.sons;l.sons=[...c.slice(0,i),...c.slice(i+1,c.length)];let a=t.sons;t.sons=[...a.slice(0,r),e,...a.slice(r,a.length)],e.father_id=t.my_id,this.setState({nodetree:s})}DroppableSpace(e){let t=this,r=e.node,s=e.expect_idx,i=this.state.nodetree;const[{is_over_can_drop:l},c]=b(()=>({accept:"treeitem",drop:(a,_)=>{!_.isOver({shallow:!0})||t.move_node(a,r,s)},collect:a=>({is_over_can_drop:a.isOver({shallow:!0})&&a.canDrop()}),canDrop:a=>r.my_id!=a.my_id&&!i.is_son(a.my_id,r.my_id)}));return d(p,{ref:c,sx:{border:l?"1px dashed grey":"0",height:"6px"}})}DragableTreeItem(e){let t=this,r=e.node,s=r.my_id,i=r.father_id,l=e.idx_in_father,c=this.state.nodetree,a=this.DroppableSpace.bind(this);const[{is_dragging:_},v]=R(()=>({type:"treeitem",item:x(g({},r),{idx_in_father:l}),collect:n=>({is_dragging:n.isDragging()})})),[{is_over:D,can_drop:I},j]=b(()=>({accept:"treeitem",drop:(n,S)=>{!S.isOver({shallow:!0})||n.my_id!=r.my_id&&t.move_node(n,r,r.sons.length)},collect:n=>({is_over:n.isOver({shallow:!0}),can_drop:n.canDrop()}),canDrop:n=>r.my_id==n.my_id||!c.is_son(n.my_id,r.my_id)}));return h(p,{ref:j,sx:{border:D&&I?"1px dashed grey":"0"},children:[d(a,{node:c.id2node(i),expect_idx:l}),h(k,{label:`node-${s}`,nodeId:`${s}`,ref:v,onFocusCapture:n=>n.stopPropagation(),sx:{cursor:"move",opacity:_?.5:1},children:[e.children,d(a,{node:r,expect_idx:r.sons.length})]})]})}get_subtree(e){let t=this,r=this.DragableTreeItem.bind(this);return d(F,{children:Object.values(e.sons).map((s,i)=>d(r,{node:s,idx_in_father:i,children:t.get_subtree(s)},`${i}`))})}async save_nodetree(){return await y.post.nodetree({nodetree:this.state.nodetree.get_raw()})}render(){let e=this,t=this.state.nodetree;return h(p,{sx:{position:"absolute",top:"2%",left:"2%",height:"96%",width:"96%",display:"flex"},children:[d(Q,{sx:{marginRight:"1%"},children:d(V,{save_func:e.save_nodetree.bind(e)})}),h(p,{sx:{position:"relative",width:"100%",flex:1},children:[d(f,{}),d($,{backend:E,children:d(N,{expanded:Object.values(e.state.expanded).map(r=>`${r}`),onNodeToggle:(r,s)=>{e.setState({expanded:s})},defaultCollapseIcon:d(P,{}),defaultExpandIcon:d(A,{}),children:e.get_subtree(t.get_root())})}),d(f,{})]})]})}}H.render(d(L.StrictMode,{children:d(G,{})}),document.getElementById("root"));
