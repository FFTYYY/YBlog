var st=Object.defineProperty,ct=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var Ce=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var ie=(t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,d=(t,e)=>{for(var r in e||(e={}))ut.call(e,r)&&ie(t,r,e[r]);if(Ce)for(var r of Ce(e))ht.call(e,r)&&ie(t,r,e[r]);return t},p=(t,e)=>ct(t,dt(e));var c=(t,e,r)=>(ie(t,typeof e!="symbol"?e+"":e,r),r);import"./modulepreload-polyfill.9d8db203.js";import{N as ft,a as m,j as n,b as h,T as x,S as mt,E as _t,w as pt,c as gt,d as yt,e as xt,P as z,f as vt,F as bt,B as Ct,g as we,h as wt,D as ke,r as P,i as y,I as k,A as kt,k as St,M as Se,l as J,m as g,n as E,o as oe,p as Ft,q as Et,s as At,C as Bt,t as I,u as Dt,v as Pt,x as It,y as Fe,z as Ee,G as Nt,H as le,J as ae,K as zt,L as R,O as Rt,Q as Ot,U as Tt,V as Mt,W as Ut,X as se,Y as ce,Z as M,_ as jt,$ as Wt,a0 as Ae,a1 as Ht,R as Vt}from"./vendor.d16f0699.js";function X(){return Math.floor(Math.random()*23333333)}function de(t=""){return{text:t}}function N(t=""){return{children:[de(t)]}}function $t(t,e,r={}){return{idx:X(),type:"inline",name:t,parameters:e,children:[de("")],hiddens:[],flags:r}}function U(t,e,r={}){return{idx:X(),type:"group",name:t,parameters:e,relation:"separating",children:[N()],hiddens:[],flags:r}}function Gt(t,e,r={}){return{idx:X(),type:"struct",name:t,num_children:1,relation:"separating",parameters:e,children:[De()],hiddens:[],flags:{}}}function Lt(t,e,r={}){return{idx:X(),type:"support",name:t,parameters:e,children:[de()],hiddens:[],flags:r}}function Be(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"}function A(t){return"type"in t}function C(t){return A(t)?t.type:"children"in t?"paragraph":"text"}function ue(t,e,r){return C(t)==e&&t.name==r}function De(){return U("struct-child",{},{})}function Jt(t,e){for(let r=0;r<t.hiddens.length;r++)if(he(t.hiddens[r],e))return r;return-1}function Pe(t,e){let r={};for(let i in t)r[i]=e(t[i]);return r}function Xt(t,e,r){return[...t.slice(0,e),r,...t.slice(e+1,t.length)]}function he(t,e){return!A(t)||!A(e)?!1:t.idx==e.idx}function j(t,e){for(let[r,i]of ft.descendants(t))if(he(r,e))return i}function fe(t,e){if(t==null)return e;if(e==null)return t;if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;let r={};for(let i in d(d({},t),e))r[i]=fe(t[i],e[i]);return r}class Ie{constructor(e,r){c(this,"core");c(this,"default_renderers");c(this,"style_renderers");this.core=e,this.default_renderers=r,this.style_renderers={inline:{},group:{},struct:{},support:{}}}get_renderer(e,r=void 0){return r==null?this.default_renderers[e]:this.style_renderers[e][r]||this.default_renderers[e]}update_renderer(e,r,i=void 0){if(i==null){this.default_renderers[r]=e;return}this.style_renderers[r][i]=e}}const Ne=m.createContext({});function ze(t){return n(Ne.Consumer,{children:e=>n(Ne.Provider,{value:d(d({},e),t.value),children:t.children})})}class Yt extends m.Component{constructor(e){super(e);c(this,"printer");c(this,"core");c(this,"my_refs");this.state={root:U("root",{})},this.printer=e.printer,this.core=this.printer.core;let r=this;this.core.add_notificatioon(i=>r.setState({root:i})),this.setState({root:this.core.root}),this.my_refs={}}scroll_to(e){this.my_refs[e]==null||this.my_refs[e].current==null||this.my_refs[e].current.scrollIntoView({behavior:"smooth",block:"center"})}_sub_component(e){let r=e.element,i=this,o=this._sub_component.bind(this),l=this.printer,a=e.contexts,s=JSON.stringify(e.now_path),u=C(r);if(u=="text"){let D=l.get_renderer("text"),ne=r.text;return h(m.Fragment,{children:[n("span",{style:{display:"hidden"},ref:i.my_refs[s]}),n(D.render_func,{element:r,context:{},children:ne})]})}let f=r.children,_;A(r)&&(_=r.name);let B=l.get_renderer(u,_);return h(m.Fragment,{children:[n("span",{style:{display:"hidden"},ref:i.my_refs[s]}),n(B.render_func,{element:r,context:a[s],children:Object.keys(f).map(D=>n(o,{element:f[D],contexts:a,now_path:[...e.now_path,parseInt(D)]},D))})]})}build_envs(e,r,i,o){let l=JSON.stringify(o);if(this.my_refs[l]=m.createRef(),!("children"in e))return[r,i];let a=e,s=C(a),u;A(a)&&(u=a.name);let _=this.printer.get_renderer(s,u),[v,B]=_.enter_effect(a,r);r=v;for(let be in a.children)[r,i]=this.build_envs(a.children[be],r,i,[...o,parseInt(be)]);let[D,ne]=_.exit_effect(a,r,B);return i[l]=ne,[D,i]}render(){let e=this,r=this._sub_component.bind(this);e.my_refs={};let[i,o]=this.build_envs(e.state.root,{},{},[]),l={refs:e.my_refs,root:e.state.root,core:e.core,printer:e.printer,printer_component:e};return n(ze,{value:l,children:n(r,{element:e.state.root,contexts:o,now_path:[]})})}}function w(t,e=(i,o)=>[o,{}],r=(i,o,l)=>[o,l]){return{render_func:t,enter_effect:e,exit_effect:r}}class me extends Ie{constructor(e){super(e,{text:w(r=>n("span",{children:r.children})),inline:w(r=>n("span",{children:r.children})),paragraph:w(r=>n("span",{children:r.children})),group:w(r=>n("span",{children:r.children})),struct:w(r=>n("span",{children:r.children})),support:w(r=>n("span",{children:r.children}))})}}c(me,"Component",Yt);function qt(t){const e=t.normalizeNode;return t.normalizeNode=r=>{const[i,o]=r;if(C(i)=="struct"){let l=i;if(l.children.length<l.num_children){let a=[];for(let s=0;s<l.num_children-l.children.length;s++)a.push(De());x.insertNodes(t,a,{at:[...o,l.children.length]});return}if(l.children.length>l.num_children){x.removeNodes(t,{at:[...o,l.children.length-1]});return}for(let a in l.children){let s=l.children[a];if(C(s)!="group"){x.removeNodes(t,{at:[...o,parseInt(a)]});return}}}e(r)},t}function Kt(t){const e=t.normalizeNode;let r=i=>C(i)=="group"||C(i)=="struct";return t.normalizeNode=i=>{const[o,l]=i;if(l.length-1,"children"in o&&C(o)!="struct"){let a=!1;for(let[s,u]of o.children.entries()){if(!r(u))continue;if(!a){a=!0;continue}a=!0;let f=u;if(s==0)return;let _=o.children[s-1];if(r(_)&&f.relation=="separating"){x.insertNodes(t,N(),{at:[...l,s]});return}if(!r(_)&&f.relation=="chaining"){x.moveNodes(t,{at:[...l,s-1],to:[...l,s]});return}}}e(i)},t}function Qt(t){const e=t.isInline;return t.isInline=r=>{if(A(r)){let i=r;if(i.flags.forceInline)return!0;if(i.flags.forceBlock)return!1}return e(r)||C(r)=="inline"},t}function Zt(t){const e=t.isVoid;return t.isVoid=r=>A(r)&&r.flags.forceVoid?!0:e(r)||C(r)=="support",t}var er=[qt,Kt,Qt,Zt];function tr(t){for(let e of er)t=e(t);return t}class rr extends m.Component{constructor(e){super(e);c(this,"editor");c(this,"core");c(this,"slate");c(this,"onUpdate");c(this,"onFocusChange");this.editor=e.editor,this.core=this.editor.core,this.slate=this.editor.slate,this.onUpdate=e.onUpdate||(r=>{}),this.onFocusChange=e.onFocusChange||(()=>{})}update_value(e){this.core.update_children(e),this.onUpdate(e)}renderElement(e){let r=this,i=e.element,o=C(i),l;A(i)&&(l=i.name);let a=this.editor.get_renderer(o,l),s=e.attributes,u={element:i,editor:r.editor,children:e.children},f={};return r.editor.slate.isInline(i)&&(f={display:"inline-block"}),n("div",p(d({},s),{style:f,children:n(a,d({},u))}))}renderLeaf(e){let r=this,i=this.editor.get_renderer("text"),o=e.attributes,l={element:e.leaf,editor:r.editor,children:e.children};return n("span",p(d({},o),{children:n(i,d({},l))}))}render(){let e=this,r={editor:e.editor,slate:e.slate,core:e.core};return n(ze,{value:r,children:n(mt,{editor:e.slate,value:[N("")],onChange:i=>{e.update_value(i),e.onFocusChange()},children:n(_t,{renderElement:e.renderElement.bind(e),renderLeaf:e.renderLeaf.bind(e),onClick:i=>{e.onFocusChange()}})})})}}class Y extends Ie{constructor(e){super(e,{text:r=>n("span",{children:r.children}),inline:r=>n("span",{children:r.children}),paragraph:r=>n("div",{children:r.children}),group:r=>n("div",{children:r.children}),struct:r=>n("div",{children:r.children}),support:r=>n("div",{children:r.children})});c(this,"suboperations");c(this,"slate");this.slate=tr(pt(gt(xt()))),this.suboperations={}}add_suboperation(e,r){this.suboperations[e]=r}apply_all(){let e=this;Object.values(this.suboperations).map(r=>{r(e)}),this.suboperations={}}get_onClick(e,r){let i=this;if(i.core.root,e=="group"||e=="support"||e=="struct"){let o=i.core.get_style(e,r);return o==null?l=>{}:l=>{let a=o.makenode();x.insertNodes(i.slate,a)}}if(e=="inline"){let o=i.core.get_style("inline",r);return o==null?l=>{}:l=>{let a=i.slate.selection,s=!0;a!=null&&(s=JSON.stringify(a.anchor)==JSON.stringify(a.focus));let u=o.makenode();s?x.insertNodes(i.slate,u):x.wrapNodes(i.slate,u,{match:f=>yt.isText(f),split:!0})}}return o=>{}}}c(Y,"Component",rr);class Re{constructor(e,r){c(this,"styles");c(this,"root");c(this,"notifications");this.styles={inline:{},group:{},struct:{},support:{},abstract:{}};for(let i of e)this.add_style(i);this.root=U("root",r),this.notifications=[]}update_children(e){return this.update_root({children:e})}update_root(e){this.root=d(d({},this.root),e);for(let r of this.notifications)r(this.root)}add_notificatioon(e){this.notifications.push(e)}add_style(e){this.styles[e.type][e.name]=e}get_style(e,r){return this.styles[e][r]}}class Oe{constructor(e,r,i={}){c(this,"type","inline");c(this,"name");c(this,"parameter_prototype");c(this,"flags");c(this,"makenode");this.name=e,this.parameter_prototype=r,this.flags=i,this.makenode=()=>$t(e,r,i)}}class W{constructor(e,r,i={}){c(this,"type","group");c(this,"name");c(this,"parameter_prototype");c(this,"flags");c(this,"makenode");this.name=e,this.parameter_prototype=r,this.flags=i,this.makenode=()=>U(e,r,i)}}class nr{constructor(e,r,i={}){c(this,"type","struct");c(this,"name");c(this,"parameter_prototype");c(this,"flags");c(this,"makenode");this.name=e,this.parameter_prototype=r,this.flags=i,this.makenode=()=>Gt(e,r,i)}}class q{constructor(e,r,i={}){c(this,"type","support");c(this,"name");c(this,"parameter_prototype");c(this,"flags");c(this,"makenode");this.name=e,this.parameter_prototype=r,this.flags=i,this.makenode=()=>Lt(e,r,i)}}class Te{constructor(e,r){c(this,"type","abstract");c(this,"name");c(this,"parameter_prototype");c(this,"flags");c(this,"makehidden");this.name=e,this.parameter_prototype=r,this.flags={},this.makehidden=()=>U(e,r)}}function H(t,e,r){let i=t.core.root;if(he(e,i)){t.core.update_root(r);return}x.setNodes(t.slate,r,{at:j(t.slate,e)})}function ir(t,e){x.removeNodes(t.slate,{at:j(t.core.root,e)})}function Me(t,e,r){x.insertNodes(t.slate,e,{at:j(t.core.root,r)})}function Ue(t,e,r){let i=j(t.core.root,r);i[i.length-1]++,x.insertNodes(t.slate,e,{at:i})}function or(t,e,r){let i=t.core.root,o=j(i,e);i.idx==e.idx&&(o=[]);let l=e.children.length;l>0&&x.removeNodes(t.slate,{at:{anchor:{path:[...o,0],offset:0},focus:{path:[...o,l-1],offset:0}}}),x.insertNodes(t.slate,r,{at:[...o,0]})}const S=m.createContext("row"),je=m.createContext(!1);function F(t){let e=t.title||"";return n(S.Consumer,{children:r=>n(wt,{title:e,placement:r=="row"?"left":"top",children:t.children})})}function lr(t){let e=!t.simple,r=i=>{let o=i=="row"?"horizontal":"vertical",l=e?i=="row"?"column":"row":i;return n(S.Provider,{value:l,children:n(Ct,p(d({orientation:o},t.buttongroup_props),{children:t.children}))})};return t.force_direction!=null?r(t.force_direction):n(S.Consumer,{children:i=>r(i)})}function b(t){let e=!t.simple,r=i=>{let o=e?i=="row"?"column":"row":i;return n(S.Provider,{value:o,children:n(we,{direction:i,children:t.children})})};return t.force_direction!=null?r(t.force_direction):n(S.Consumer,{children:i=>r(i)})}function ar(t){let e=r=>n(S.Provider,{value:r,children:n(we,{direction:r,children:t.children})});return t.force_direction!=null?e(t.force_direction):n(S.Consumer,{children:r=>e(r)})}class sr extends m.Component{constructor(e){super(e)}render(){let e=this.props,r=e.stacker||b,i=e.component||z,o=l=>n(je.Consumer,{children:a=>n(vt,{anchorEl:e.anchorEl,open:e.open,placement:l=="row"?"right":"bottom",disablePortal:a,transition:!0,children:({TransitionProps:s})=>n(bt,p(d({},s),{timeout:350,children:n(i,{children:n(r,{children:e.children})})}))})});return e.force_direction!=null?o(e.force_direction):n(S.Consumer,{children:l=>o(l)})}}const We={palette:{divider:"#00000077",primary:{main:"#111111"}},editor:{margins:{background:"0.5rem",paragraph:"0.8rem",small:"0.2rem"},widths:{editable_drawer:"70%",minimum_content:"3rem"},typography:{body:{fontFamily:"default",fontSize:"1rem",lineHeight:"1.5rem",lineSpacing:"0.00938em",fontWeight:400},structure:{fontFamily:"Century Gothic, SimHei",fontSize:"1rem",lineHeight:"1.5rem",lineSpacing:"0.00938em",fontWeight:400}}},printer:{margins:{paragraph:"0.4rem",special:"0.8rem",colon:"1rem",level:"2rem",structure:"0.4rem"},typography:{body:{fontFamily:"default",fontSize:"1rem",lineHeight:"1.5rem",lineSpacing:"0.00938em",fontWeight:400},weaken:{fontFamily:"default",fontSize:"1rem",lineHeight:"1.5rem",lineSpacing:"0.00938em",fontWeight:400},structure:{fontFamily:"default",fontSize:"1rem",lineHeight:"1.5rem",lineSpacing:"0.00938em",fontWeight:400},display:{fontFamily:"default",fontSize:"1rem",lineHeight:"1.5rem",lineSpacing:"0.00938em",fontWeight:400}}}};function cr(t){let e=t.element,r=t.editor,i=r.core.styles.abstract,o=t.onClose||(a=>{});function l(a){return s=>{if(o(s),a==null||i[a]==null)return;let u=[...e.hiddens,i[a].makehidden()];H(r,e,{hiddens:u})}}return n(Se,{anchorEl:t.anchor_element,open:t.open,onClose:o,children:Object.keys(i).map(a=>n(J,{onClick:l(a),children:a},a))})}class dr extends m.Component{constructor(e){super(e);c(this,"subeditor");c(this,"hiddenid");c(this,"father_editor");c(this,"father");c(this,"son");this.state={drawer_open:!1},this.subeditor=new Y(new Re([...Object.values(e.editor.core.styles.inline),...Object.values(e.editor.core.styles.group),...Object.values(e.editor.core.styles.struct),...Object.values(e.editor.core.styles.support),...Object.values(e.editor.core.styles.abstract)],{})),this.subeditor.default_renderers=e.editor.default_renderers,this.subeditor.style_renderers=e.editor.style_renderers,this.father_editor=e.editor,this.father=e.father,this.son=e.son}sub_apply(e){let r=this.father,i=this.son,o=Jt(r,i),l=p(d({},i),{children:this.subeditor.core.root.children}),a=Xt(r.hiddens,o,l);H(e,r,{hiddens:a})}render(){let e=this;return this.props,n(ke,{anchor:"left",open:e.props.open,onClose:e.props.onClose,ModalProps:{keepMounted:!0},PaperProps:{sx:{width:"60%"}},SlideProps:{onExited:()=>{e.father_editor.apply_all()}},children:n(je.Provider,{value:!0,children:n(Ge,{editor:e.subeditor,onMount:()=>{or(e.subeditor,e.subeditor.core.root,e.props.son.children),e.props.editor.add_suboperation(`${e.son.idx}-hidden`,e.sub_apply.bind(e))}})})})}}function ur(t){let e=t.element,r=t.editor,i=e.hiddens,o=t.onClose||(s=>{}),[l,a]=P.exports.useState(void 0);return h(y,{children:[n(Se,{anchorEl:t.anchor_element,open:t.open,onClose:t.onClose,children:Object.keys(i).map(s=>h(J,{onClick:u=>{a(s),o(u)},children:[i[s].name,"-",s]},s))}),Object.keys(i).map(s=>n(dr,{editor:r,father:e,son:e.hiddens[s],open:l==s,onClose:u=>{a(void 0)}},s))]})}function K(t){let e=t.editor,r=t.element,[i,o]=P.exports.useState(void 0),[l,a]=P.exports.useState(void 0);return h(y,{children:[n(F,{title:"\u65B0\u5EFA\u62BD\u8C61",children:n(k,{onClick:s=>o(s.currentTarget),children:n(kt,{})})}),n(F,{title:"\u7F16\u8F91\u62BD\u8C61",children:n(k,{onClick:s=>a(s.currentTarget),children:n(St,{})})}),n(cr,{editor:e,element:r,anchor_element:i,open:i!=null,onClose:s=>o(void 0)}),n(ur,{editor:e,element:r,anchor_element:l,open:l!=null,onClose:s=>{a(void 0)}})]})}const V=t=>n(g,p(d({contentEditable:!1},t),{sx:[{userSelect:"none"},...Array.isArray(t.sx)?t.sx:[t.sx]]})),hr=t=>n(E,p(d({component:g},t),{sx:[e=>p(d({},e.editor.typography.body),{marginTop:e.editor.margins.paragraph}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),_e=t=>n(E,p(d({component:g},t),{sx:[e=>p(d({},e.editor.typography.structure),{marginY:"auto",height:e.editor.typography.structure.lineHeight,whiteSpace:"nowrap"}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),Q=t=>n(g,p(d({},t),{autogrow:void 0,sx:[d({paddingX:e=>e.editor.margins.background},t.autogrow?{flex:1,minWidth:0}:{}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),He=t=>n(z,p(d({elevation:0,variant:"outlined",square:!0},t),{is_inline:void 0,sx:[d({},t.is_inline?{display:"inline-block",height:e=>e.editor.typography.body.lineHeight,color:e=>e.palette.secondary.dark,marginX:e=>e.editor.margins.small}:{marginTop:e=>e.editor.margins.paragraph,color:e=>e.palette.primary.main}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),Ve=t=>n(g,p(d({},t),{sx:[{marginTop:e=>e.editor.margins.paragraph},...Array.isArray(t.sx)?t.sx:[t.sx]]})),fr=t=>n(z,p(d({elevation:0,variant:"outlined",square:!0},t),{sx:[{width:"100%",height:"100%",overflow:"hidden"},...Array.isArray(t.sx)?t.sx:[t.sx]]}));class mr extends m.Component{constructor(e){super(e);c(this,"parameters");c(this,"onUpdate");this.parameters=this.props.initval,this.onUpdate=e.onUpdate||(r=>{})}get_all_treenodes(e,r){let i=this,o=[];for(let l in r){let a=[...e,l];Be(r[l])||(o.push(a),o=[...o,...i.get_all_treenodes(a,r[l])])}return o}renderValue(e){let r=e.name,i=e.val,o=e.onChange,l={defaultValue:i,label:r,variant:"standard",sx:{marginLeft:"5%"}};return typeof i=="string"?n(oe,d({onChange:a=>o(a.target.value)},l)):typeof i=="number"?n(oe,d({onChange:a=>o(a.target.value),type:"number"},l)):typeof i=="boolean"?h(oe,p(d({onChange:a=>{o(a.target.value=="true")},select:!0},l),{children:[n(J,{value:"true",children:"true"},0),n(J,{value:"false",children:"false"},1)]})):n(y,{})}renderDict(e){let r=d({},e.val),i=this.renderValue.bind(this),o=this.renderDict.bind(this),l=[...e.father_names,e.name],a=JSON.stringify(l);return n(Ft,{nodeId:a,label:e.name,sx:{width:"auto",overflowX:"hidden"},children:Object.keys(e.val).map(s=>{let u=e.val[s];return Be(u)?n(i,{name:s,val:u,onChange:f=>{r[s]=f,e.onChange(r)}},s):n(o,{name:s,val:u,father_names:l,onChange:f=>{r[s]=f,e.onChange(r)}},s)})})}render(){let e=this.renderDict.bind(this),r=this,i="Parameters",o=Object.values(this.get_all_treenodes([],{[i]:r.parameters})).map(l=>JSON.stringify(l));return n(Et,{defaultExpanded:o,disableSelection:!0,disabledItemsFocusable:!0,defaultCollapseIcon:n(At,{}),defaultExpandIcon:n(Bt,{}),children:n(e,{name:i,val:r.parameters,father_names:[],onChange:l=>{r.parameters=l,r.onUpdate(l)}})})}}function _r(t){function e(r){t.editor.add_suboperation(`${t.element.idx}-parameter`,i=>{H(i,t.element,{parameters:r})})}return n(mr,{initval:t.element.parameters,onUpdate:r=>e(r)})}function pr(t){let e=t.onClose||(r=>{});return h(ke,{anchor:"left",open:t.open,onClose:e,ModalProps:{keepMounted:!0},SlideProps:{onExited:()=>{t.editor.apply_all()}},PaperProps:{sx:{width:"40%"}},children:[n(g,{children:h(_e,{children:["idx: ",t.element.idx]})}),n(I,{}),n(_r,{editor:t.editor,element:t.element})]})}function Z(t){let e=t.icon;return n(F,{title:t.title,children:n(k,{onClick:t.onClick,size:t.size,children:n(e,{})})})}function $(t){let[e,r]=P.exports.useState(!1),i=t.onClose||(o=>{});return h(y,{children:[n(Z,{onClick:o=>r(!0),title:"\u8BBE\u7F6E\u53C2\u6570",icon:Dt}),n(pr,{editor:t.editor,element:t.element,open:e,onClose:o=>{i(o),r(!1)}})]})}function ee(t){return n(Z,{onClick:e=>{ir(t.editor,t.element)},title:"\u5220\u9664\u7EC4\u4EF6",icon:It})}function pe(t){return h(m.Fragment,{children:[n(Z,{onClick:e=>{Me(t.editor,N(),t.element)},title:"\u5411\u4E0A\u6DFB\u52A0\u6BB5\u843D",icon:Fe}),n(Z,{onClick:e=>{Ue(t.editor,N(),t.element)},title:"\u5411\u4E0B\u6DFB\u52A0\u6BB5\u843D",icon:Ee})]})}function te(t){let e=t.button_class,[r,i]=m.useState(!1),o=m.useRef(),l=t.onClose||(()=>{}),a=u=>{i(u),u||l()},s=h(m.Fragment,{children:[n(F,{title:t.title,children:n(e,d({onClick:u=>a(!r),ref:o},t.button_props))}),n(sr,p(d({anchorEl:o.current,open:r},t.poper_props),{children:t.children}))]});return t.close_on_otherclick?n(Pt,{onClickAway:()=>{a(!1)},children:n(g,{children:s})}):s}function $e(t){let e=t.element,r=t.editor,[i,o]=P.exports.useState(e.relation=="chaining");function l(a){let s=a.target.checked;o(s),s==!1&&H(r,e,{relation:"separating"}),s==!0&&H(r,e,{relation:"chaining"})}return n(F,{title:"\u8D34\u5408",children:n(Nt,{checked:i,onChange:l})})}class Ge extends m.Component{constructor(e){super(e);c(this,"editor");c(this,"onUpdate");c(this,"onMount");c(this,"onFocusChange");this.editor=e.editor,this.onUpdate=e.onUpdate||(r=>{}),this.onMount=e.onMount||(()=>{}),this.onFocusChange=e.onFocusChange||(()=>{})}componentDidMount(){this.onMount()}render(){let e={group:Rt,inline:Ot,support:Tt,struct:Mt},r={xs:.15,md:.1,xl:.05},i=Pe(r,s=>1-s),o=s=>Pe(s,u=>`${Math.floor(u*100)%100}%`),l=fe(We,this.props.theme),a=this;return n(le,{theme:ae(l),children:h(fr,{children:[n(g,{sx:{position:"absolute",height:"100%",width:i,overflow:"auto"},children:n(Q,{children:n(Y.Component,{editor:a.editor,onUpdate:a.onUpdate,onFocusChange:a.onFocusChange})})}),n(g,{sx:{position:"absolute",height:"100%",left:o(i),width:r},children:h(b,{force_direction:"column",children:[n($,{editor:a.editor,element:a.editor.core.root}),n(K,{editor:a.editor,element:a.editor.core.root}),n(I,{}),["group","inline","support","struct"].map(s=>{let u=e[s];return n(m.Fragment,{children:n(te,{poper_props:{stacker:lr,component:zt(z)({backgroundColor:"#aabbdd55"})},button_class:k,button_props:{children:n(u,{})},title:s,children:Object.keys(a.editor.core.styles[s]).map(f=>h(m.Fragment,{children:[n(R,{onClick:_=>a.editor.get_onClick(s,f)(_),variant:"text",children:f}),n(I,{orientation:"vertical",flexItem:!0})]},f))})},s)})]})})]})})}}let Le=t=>n(He,p(d({},t),{sx:t.element.relation=="chaining"?{marginTop:"0"}:{}}));function gr(t=i=>i.title,e=i=>n(y,{}),r=i=>n(y,{children:i.children})){return i=>{let o=i.element,l=t(o.parameters),a=i.editor;return n(Le,{element:o,children:h(b,{force_direction:"column",children:[n(V,{children:n(Ut,{sx:{overflow:"auto"},children:h(b,{children:[n(_e,{children:l}),n($,{editor:a,element:o}),n(K,{editor:a,element:o}),n($e,{editor:a,element:o}),n(pe,{editor:a,element:o}),n(ee,{editor:a,element:o}),n(e,{editor:a,element:o})]})})}),n(I,{}),n(Q,{autogrow:!0,children:n(r,{editor:a,element:o,children:i.children})})]})})}}function ge(t=i=>i.title,e=i=>n(y,{}),r=i=>n(y,{children:i.children})){return i=>{let o=i.element,l=t(o.parameters),a=i.editor,s=e;return n(Le,{element:o,children:h(b,{force_direction:"row",children:[n(Q,{autogrow:!0,children:n(r,{editor:a,element:o,children:i.children})}),n(V,{children:h(ar,{children:[n(_e,{variant:"overline",children:l}),n(s,{editor:a,element:o}),h(te,{close_on_otherclick:!0,button_class:k,button_props:{size:"small",children:n(se,{fontSize:"small"})},title:"\u5C55\u5F00",children:[n($,{editor:a,element:o}),n(K,{editor:a,element:o}),n($e,{editor:a,element:o}),n(ee,{editor:a,element:o}),n(pe,{editor:a,element:o})]})]})})]})})}}function yr(t="",e=i=>n(m.Fragment,{children:i.children}),r=i=>n(y,{})){return i=>{let o=i.element,l=i.editor,a=r;return n(He,{is_inline:!0,children:h(b,{force_direction:"row",children:[n(Q,{children:n(e,{editor:l,element:o,children:i.children})}),n(V,{children:h(b,{force_direction:"row",children:[n(a,{editor:l,element:o}),h(te,{close_on_otherclick:!0,button_class:k,button_props:{sx:{height:"1rem",width:"1rem",margin:"0"},children:n(se,{sx:{height:"1rem"}})},title:"\u5C55\u5F00"+(t?` / ${t}`:""),children:[n(E,{children:o.name}),n($,{editor:l,element:o}),n(K,{editor:l,element:o}),n(ee,{editor:l,element:o})]})]})})]})})}}function xr(t){let e=t.element,r=t.editor,[i,o]=m.useState(!1),[l,a]=m.useState(!1),s=n(z,{sx:{height:"5px"},variant:"outlined"});return n(V,{children:n(Ve,{children:h(S.Provider,{value:"row",children:[t.children,h(ce,{container:!0,spacing:2,children:[n(ce,{item:!0,xs:6,children:n(g,{onMouseOver:()=>o(!0),onMouseOut:()=>o(!1),children:(()=>i?n(F,{title:"\u5411\u4E0A\u6DFB\u52A0\u6BB5\u843D",children:n(R,{onClick:u=>{Me(r,N(),e)},size:"small",variant:"outlined",fullWidth:!0,children:n(Fe,{fontSize:"small"})})}):s)()})}),n(ce,{item:!0,xs:6,children:n(g,{onMouseOver:()=>a(!0),onMouseOut:()=>a(!1),children:(()=>l?n(F,{title:"\u5411\u4E0B\u6DFB\u52A0\u6BB5\u843D",children:n(R,{onClick:u=>{Ue(r,N(),e)},size:"small",variant:"outlined",fullWidth:!0,children:n(Ee,{fontSize:"small"})})}):s)()})})]})]})})})}function Je(t=e=>e.name){return e=>{let r=e.editor,i=e.element,o=t(i.parameters);return n(V,{children:n(Ve,{children:h(I,{children:[n(z,{variant:"outlined",children:h(b,{force_direction:"row",children:[n(E,{children:o}),h(te,{close_on_otherclick:!0,button_class:k,button_props:{size:"small",children:n(se,{fontSize:"small"})},title:"\u5C55\u5F00",children:[n($,{editor:e.editor,element:e.element}),n(pe,{editor:r,element:i}),n(ee,{editor:r,element:i})]})]})}),e.children]})})})}}function vr(t){return n(hr,{children:t.children})}const br=t=>n(E,p(d({component:t.inline?"span":g},t),{inline:void 0,sx:[e=>d(d({},e.printer.typography.weaken),t.inline?{marginRight:r=>r.printer.margins.colon,display:"inline-block"}:{}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),Xe=t=>n(E,p(d({component:t.inline?"span":g},t),{inline:void 0,sx:[e=>d(d({},e.printer.typography.display),t.inline?{marginRight:r=>r.printer.margins.colon,display:"inline-block"}:{}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),Cr=t=>n(E,p(d({component:g},t),{sx:[e=>({fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",lineSpacing:"inherit",fontWeight:"inherit",marginTop:e.printer.margins.paragraph}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),G=t=>n(E,p(d({component:t.inline?"span":g},t),{inline:void 0,sx:[e=>d(d({},e.printer.typography.structure),t.inline?{marginRight:r=>r.printer.margins.colon,display:"inline-block"}:{}),...Array.isArray(t.sx)?t.sx:[t.sx]]})),wr=t=>n(g,p(d({},t),{sx:[{marginTop:e=>e.printer.margins.special,marginBottom:e=>e.printer.margins.special},...Array.isArray(t.sx)?t.sx:[t.sx]]})),kr=t=>n(g,p(d({},t),{sx:[{marginLeft:e=>e.printer.margins.level},...Array.isArray(t.sx)?t.sx:[t.sx]]})),Sr=t=>n(g,p(d({},t),{sx:[e=>p(d({},e.printer.typography.body),{padding:e.printer.margins.structure,boxSizing:"border-box",height:"100%",width:"100%",overflowY:"auto",wordWrap:"break-word"}),...Array.isArray(t.sx)?t.sx:[t.sx]]}));class Fr extends m.Component{constructor(e){super(e);c(this,"printer");c(this,"main");this.printer=e.printer,this.main=m.createRef()}scroll_to(e){this.main.current!=null&&this.main.current.scroll_to(e)}render(){let e=fe(We,this.props.theme),r=this.main;return n(le,{theme:ae(e),children:n(Sr,{id:"haha",children:n(me.Component,{ref:r,printer:this.printer})})})}}class ye{constructor(e,r,i){c(this,"env_key");c(this,"context_key");c(this,"_default_val");this.env_key=e,this.context_key=r,this._default_val=i}enter_effect(e,r,i){return[r,{}]}exit_effect(e,r,i){return[r,i]}ensure_env(e){return e[this.env_key]==null&&(e[this.env_key]=this._default_val),e}get_env(e){return e=this.ensure_env(e),e[this.env_key]}set_env(e,r){return e=this.ensure_env(e),e[this.env_key]=r,e}get_context(e){return e[this.context_key]}set_context(e,r){return e[this.context_key]=r,e}make_context(e){return{[this.context_key]:e}}fuse_result(e,r){let[i,o]=e,[l,a]=r;return[l,d(d({},o),a)]}enter_fuse(e,r,i){return this.fuse_result([r,i],this.enter_effect(e,r,i))}exit_fuse(e,r,i){return this.fuse_result([r,i],this.exit_effect(e,r,i))}}class Er extends ye{constructor(e,r,i=(o,l,a)=>!1){r==null&&(r=e);super(e,r,0);c(this,"clear_order");this.clear_order=i}enter_effect(e,r,i){r=this.ensure_env(r);let o=this.get_env(r);return this.clear_order(e,r)&&(o=0),o++,r=this.set_env(r,o),[r,this.make_context(o)]}exit_effect(e,r,i){let o=this.get_context(i);return r=this.set_env(r,o),[r,this.make_context(o)]}}class Ar extends ye{constructor(e,r,i,o){super(e,r,[]);c(this,"pre_inject");c(this,"suf_inject");this.pre_inject=i||(l=>n(y,{})),this.suf_inject=o||(l=>n(y,{}))}enter_effect(e,r,i){let o=this.pre_inject;return r=this.set_env(r,[...this.get_env(r),n(o,{element:e,context:i})]),[r,i]}exit_effct(e,r,i){let o=this.suf_inject;return r=this.set_env(r,[...this.get_env(r),n(o,{element:e,context:i})]),[r,i]}}class Br extends ye{constructor(e,r){super(e,r,[])}enter_effect(e,r,i){let o=this.get_env(r);return r=this.set_env(r,[]),[r,this.make_context(o)]}}function re({extra_effectors:t=[],inject_pre:e=l=>n(y,{}),inject_suf:r=l=>n(y,{}),outer:i=l=>n(wr,{children:l.children}),inner:o=l=>n(y,{children:l.children})}){let l=i,a=o,s=new Ar("global-injector","global-injector",e,r);return{render_func:u=>{let f=u.element;return n(l,{element:f,context:u.context,children:n(a,{element:f,context:u.context,children:u.children})})},enter_effect:(u,f)=>{let _=[f,{}];for(let v of t)_=v.enter_fuse(u,_[0],_[1]);return _=s.enter_fuse(u,_[0],_[1]),_},exit_effect:(u,f,_)=>{let v=[f,_];for(let B of t)v=B.exit_fuse(u,v[0],v[1]);return v=s.exit_fuse(u,v[0],v[1]),v}}}function Dr(){let t=new Br("global-injector","global-injector");return{render_func:e=>{let r=t.get_context(e.context);return h(Cr,{children:[Object.keys(r).map(i=>n(m.Fragment,{children:r[i]},i)),e.children,n("br",{})]})},enter_effect:(e,r)=>{let i=[r,{}];return i=t.enter_fuse(e,i[0],i[1]),i},exit_effect:(e,r,i)=>{let o=[r,i];return o=t.exit_fuse(e,o[0],o[1]),o}}}function Pr(t){return parseInt(t.slice(0,t.length-3))}function Ir(t){return`${t}rem`}function Nr(t,e){return Ir(Math.floor(Pr(t)*e))}var zr=(()=>{let t=new Er("order/theorem","order/theorem");return re({extra_effectors:[t],inject_pre:r=>{let i=t.get_context(r.context),o=r.element.parameters.title,l=r.element.parameters.alias;return h(G,{inline:!0,children:[o," ",i,l?` (${l})`:""]})}})})(),Rr=(()=>re({inner:t=>{let e=t.element.parameters.enter,r=t.element.parameters.exit;return h(b,{force_direction:"column",children:[e?n(G,{children:e}):n(y,{}),n(kr,{children:n(br,{children:t.children})}),r?n(G,{children:r}):n(y,{})]})}}))(),Or=(()=>re({inner:t=>{let e=t.element.parameters.enter,r=t.element.parameters.exit;return h(b,{force_direction:"column",children:[e?n(G,{children:e}):n(y,{}),n(Xe,{align:"center",children:t.children}),r?n(G,{align:"right",children:r}):n(y,{})]})}}))(),Tr=(()=>re({inner:t=>n(b,{force_direction:"column",children:n(Xe,{sx:{fontSize:e=>Nr(e.printer.typography.structure.fontSize,2)},children:t.children})})}))(),Ye=(()=>w(t=>{let r=t.element.parameters.title;return n(I,{children:r})}))(),qe=(()=>w(t=>(t.element,n(I,{}))))(),Mr=(()=>w(t=>n("strong",{children:t.children})))(),Ur=(()=>w(t=>n(y,{})))(),jr=Dr(),Wr=gr(t=>t.title),Hr=ge(t=>"\u968F\u8A00"),Vr=ge(t=>"\u88F1\u793A"),$r=ge(t=>"\u5F70\u793A"),Ke=xr,Qe=Je(t=>t.title),Ze=Je(t=>"\u7AE0\u8282"),Gr=yr(),Lr=vr,et=new W("\u662D\u8A00",{title:"\u662D\u8A00",alias:""}),tt=new W("\u968F\u8A00",{enter:"",exit:""}),rt=new W("\u88F1\u793A",{enter:"",exit:""}),nt=new W("\u5F70\u793A",{}),L=new q("\u65B0\u6BB5",{}),O=new q("\u5C0F\u8282\u7EBF",{title:""}),T=new q("\u7AE0\u8282\u7EBF",{}),it=new Oe("\u5F3A\u8C03",{}),ot=new Te("\u7A46\u8A00",{}),Jr={group:W,inline:Oe,abstract:Te,suport:q,struct:nr},Xr={[et.name]:[et,Wr,zr],[tt.name]:[tt,Hr,Rr],[rt.name]:[rt,Vr,Or],[nt.name]:[nt,$r,Tr],[ot.name]:[ot,void 0,void 0],[L.name]:[L,Ke,void 0],[O.name]:[O,Qe,Ye],[T.name]:[T,Ze,qe],[it.name]:[it,Gr,Mr]};function Yr(t,e,r,i,o){let[l,a,s]=Xr[t],u=Jr[l.type],f=d(d(d(d({},l.parameter_prototype),r),i),o),_=l.flags;return[new u(e,f,_),a,s]}function qr(t){return t.add_style(L),t.add_style(O),t.add_style(T),t}function Kr(t){return t.update_renderer(Lr,"paragraph"),t.update_renderer(Ke,"support",L.name),t.update_renderer(Qe,"support",O.name),t.update_renderer(Ze,"support",T.name),t}function Qr(t){return t.update_renderer(jr,"paragraph"),t.update_renderer(Ur,"support",L.name),t.update_renderer(Ye,"support",O.name),t.update_renderer(qe,"support",T.name),t}function Zr(t){let e="";if(document.cookie&&document.cookie!==""){const r=document.cookie.split(";");for(let i=0;i<r.length;i++){const o=r[i].trim();if(o.substring(0,t.length+1)===t+"="){e=decodeURIComponent(o.substring(t.length+1));break}}}return e}const en=Zr("csrftoken");var tn="http://127.0.0.1:8000";M.defaults.baseURL=tn;M.defaults.headers.post["X-CSRFToken"]=en;function rn(){return 1}const lt=P.exports.createContext(!1);function at(t){let r=t.no_button||!1?g:R,i=p(d({},t),{close_item:void 0,open_item:void 0,no_button:void 0});return n(lt.Consumer,{children:o=>n(r,p(d({},i),{children:o?t.open_item:t.close_item}))})}class nn extends P.exports.Component{constructor(e){super(e);this.state={open:!1}}render(){let e=this;return n(g,{sx:d({},e.props.sx),children:n(lt.Provider,{value:e.state.open,children:h(b,{force_direction:"column",children:[n(at,{close_item:n(F,{title:"\u5C55\u5F00",children:n(k,{size:"small",children:n(jt,{fontSize:"small",color:"primary"})})}),open_item:n(R,{startIcon:n(Wt,{}),color:"primary",children:"\u6536\u655B"}),onClick:()=>{e.setState({open:!e.state.open})},no_button:!0}),e.props.children]})})})}}const xe={palette:{divider:"#00000077",primary:{main:"#111111"}},printer:{margins:{paragraph:"0.4rem",special:"0.8rem",colon:"1rem",level:"2rem"},typography:{body:{fontFamily:"STXihei"},structure:{fontFamily:"DengXian",fontWeight:600},display:{fontFamily:"KaiTi"},weaken:{fontFamily:"FangSong"}}}};function on(t){let[e,r]=m.useState(!1),[i,o]=m.useState(!1);return h(m.Fragment,{children:[n(at,{close_item:n(F,{title:"\u4FDD\u5B58",children:n(k,{size:"small",children:n(Ae,{fontSize:"small",color:"primary"})})}),open_item:n(R,{startIcon:n(Ae,{}),color:"primary",children:"\u4FDD\u5B58"}),onClick:()=>{t.save_func().then(l=>{o(l),r(!0)})},no_button:!0}),n(Ht,{anchorOrigin:{vertical:"top",horizontal:"center"},open:e,message:i?"\u4FDD\u5B58\u6210\u529F":"\u4FDD\u5B58\u5931\u8D25",onClose:()=>r(!1)})]})}function ln(t){const e=t.normalizeNode;return t.normalizeNode=r=>{let[i,o]=r;if(o.length==0){let l=i,a=l.children.length;if(a==0||!ue(l.children[0],"support","\u5C0F\u8282\u7EBF")){x.insertNodes(t,O.makenode(),{at:[0]});return}if(!ue(l.children[a-1],"support","\u7AE0\u8282\u7EBF")){x.insertNodes(t,T.makenode(),{at:[a]});return}}if(ue(i,"support","\u7AE0\u8282\u7EBF")&&(o.length!=1||o[0]!=t.children.length-1)){x.removeNodes(t,{at:o});return}e(r)},t}let an=[ln];function sn(t){for(let e of an)t=e(t);return t}var ve=rn();class cn extends m.Component{constructor(e){super(e);c(this,"editor");c(this,"core");c(this,"printer");c(this,"printer_ref");c(this,"flag");this.core=qr(new Re([],{})),this.state={editor:Kr(new Y(this.core)),printer:Qr(new me(this.core))},this.state.editor.slate=sn(this.state.editor.slate),this.printer_ref=m.createRef()}async componentDidMount(){let e=this.state.editor,r=this.state.printer;var i=(await M.get(`/get_node_components/${ve}`)).data.components;for(let[l,a,s,u,f]of i){let[_,v,B]=Yr(a,l,s,u,f);this.core.add_style(_),e.update_renderer(v,_.type,_.name),r.update_renderer(B,_.type,_.name)}this.setState({editor:e,printer:r});var o=(await M.get(`/get_node/${ve}`)).data.content;x.insertNodes(this.state.editor.slate,o,{at:[0]})}async on_click_save(e){var r={content:this.core.root.children};return(await M.post(`/post_node/${ve}`,r)).data.status}mainpart(e){let r=this;return h(g,{sx:e.sx,children:[n(g,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:n(Ge,{editor:r.state.editor,theme:xe,onFocusChange:()=>{if(r.state.editor.slate.selection&&r.printer_ref&&r.printer_ref.current){let i=JSON.stringify(r.state.editor.slate.selection.focus.path);r.printer_ref.current.scroll_to(i)}}})}),n(g,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:n(Fr,{printer:r.state.printer,ref:this.printer_ref,theme:xe})})]})}render(){let e=this,r=this.mainpart.bind(this);return console.log("group render",e.state.editor.style_renderers.group),console.log("children render",e.state.editor.slate.children),n(le,{theme:ae(xe),children:h(g,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:[n(nn,{sx:{marginRight:"1%"},children:n(on,{save_func:e.on_click_save.bind(e)})}),n(r,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})}}Vt.render(n(m.StrictMode,{children:n(cn,{})}),document.getElementById("root"));
