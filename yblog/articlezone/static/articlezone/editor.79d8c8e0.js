var ue=Object.defineProperty,ce=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var I=(n,e,r)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,A=(n,e)=>{for(var r in e||(e={}))pe.call(e,r)&&I(n,r,e[r]);if(j)for(var r of j(e))he.call(e,r)&&I(n,r,e[r]);return n},M=(n,e)=>ce(n,de(e));var S=(n,e,r)=>(I(n,typeof e!="symbol"?e+"":e,r),r);import{r as $,j as t,b as m,a as c,R as _e}from"./jsx-runtime.71fbd6ab.js";import{g as me,a as fe,s as ge,_ as T,u as xe,b as ye,c as ve,d as Fe,F as be,e as Ee,T as te,f as N,h as z,i as Se,j as P,k as re,I as b,B as v,A as C,P as ze,l as L,m as B,n as H,o as ne,p as k,D as Ce,C as we,q as ie,r as oe,t as J,v as R,w,L as X,x as Ae,y as Y,z as Le,E as Be,G as ke,H as Ie,J as Me}from"./titleword.a6ed5a6e.js";import{s as Pe,e as De,w as $e,E as Te,a as Ne,S as W,b as Ve,c as q,l as He,m as D,M as Re,d as Oe}from"./theme.355d57d8.js";import{F as O,a as Ue,S as je}from"./buttons.dabedcdb.js";import{P as V}from"./snackbar.2b8238f2.js";function Je(n){return me("MuiInputAdornment",n)}const Xe=fe("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var G=Xe,K;const Ye=["children","className","component","disablePointerEvents","disableTypography","position","variant"],We=(n,e)=>{const{ownerState:r}=n;return[e.root,e[`position${N(r.position)}`],r.disablePointerEvents===!0&&e.disablePointerEvents,e[r.variant]]},qe=n=>{const{classes:e,disablePointerEvents:r,hiddenLabel:l,position:i,size:a,variant:s}=n,o={root:["root",r&&"disablePointerEvents",i&&`position${N(i)}`,s,l&&"hiddenLabel",a&&`size${N(a)}`]};return Fe(o,Je,e)},Ge=ge("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:We})(({theme:n,ownerState:e})=>T({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:n.palette.action.active},e.variant==="filled"&&{[`&.${G.positionStart}&:not(.${G.hiddenLabel})`]:{marginTop:16}},e.position==="start"&&{marginRight:8},e.position==="end"&&{marginLeft:8},e.disablePointerEvents===!0&&{pointerEvents:"none"})),Ke=$.exports.forwardRef(function(e,r){const l=xe({props:e,name:"MuiInputAdornment"}),{children:i,className:a,component:s="div",disablePointerEvents:o=!1,disableTypography:u=!1,position:g,variant:d}=l,x=ye(l,Ye),p=ve()||{};let h=d;d&&p.variant,p&&!h&&(h=p.variant);const f=T({},l,{hiddenLabel:p.hiddenLabel,size:p.size,disablePointerEvents:o,position:g,variant:h}),_=qe(f);return t(be.Provider,{value:null,children:t(Ge,T({as:s,ownerState:f,className:Ee(_.root,a),ref:r},x,{children:typeof i=="string"&&!u?t(te,{color:"text.secondary",children:i}):m($.exports.Fragment,{children:[g==="start"?K||(K=t("span",{className:"notranslate",children:"\u200B"})):null,i]})}))})});var Q=Ke,Qe=z(t("path",{d:"m22.25 14.29-.69 1.89L9.2 11.71l2.08-5.66 8.56 3.09c2.1.76 3.18 3.06 2.41 5.15zM1.5 12.14 8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86-.69 1.89zm5.8-1.94c1.49-.72 2.12-2.51 1.41-4C7.99 4.71 6.2 4.08 4.7 4.8c-1.49.71-2.12 2.5-1.4 4 .71 1.49 2.5 2.12 4 1.4z"}),"AirlineSeatFlatAngled"),Ze=z(t("path",{d:"M6 6.5c.31 0 .7.15.9.56.24.5.02 1.1-.47 1.34-.14.06-.28.1-.43.1-.3 0-.7-.15-.89-.56-.17-.34-.1-.63-.05-.78.05-.14.18-.4.51-.56.14-.06.28-.1.43-.1m6.47 2.11 6.69 2.41c.52.19.93.56 1.15 1.05.22.48.25 1.03.06 1.53l-.01.02-8.59-3.11.7-1.9M10 15.19l4 1.44V17h-4v-1.81M6 4.5c-.44 0-.88.1-1.3.3-1.49.71-2.12 2.5-1.4 4 .51 1.07 1.58 1.7 2.7 1.7.44 0 .88-.1 1.3-.3 1.49-.72 2.12-2.51 1.41-4C8.19 5.13 7.12 4.5 6 4.5zm5.28 1.55L9.2 11.71l12.36 4.47.69-1.89c.77-2.09-.31-4.39-2.41-5.15l-8.56-3.09zm-9.09 4.2-.69 1.89L8 14.48V19h8v-1.63L20.52 19l.69-1.89-19.02-6.86z"}),"AirlineSeatFlatAngledOutlined"),Z=z(t("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41l-2.33-2.35zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"}),"AutoFixHigh"),et=z(t("path",{d:"M18.41 5.8 17.2 4.59c-.78-.78-2.05-.78-2.83 0l-2.68 2.68L3 15.96V20h4.04l8.74-8.74 2.63-2.63c.79-.78.79-2.05 0-2.83zM6.21 18H5v-1.21l8.66-8.66 1.21 1.21L6.21 18zM11 20l4-4h6v4H11z"}),"DriveFileRenameOutline"),ae=z(t("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"}),"DriveFolderUpload"),ee=z(t("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4 6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"}),"FileCopy"),tt=z(t("path",{d:"M9.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5.75 8.9 3 23h2.1l1.75-8L9 17v6h2v-7.55L8.95 13.4l.6-3C10.85 12 12.8 13 15 13v-2c-1.85 0-3.45-1-4.35-2.45l-.95-1.6C9.35 6.35 8.7 6 8 6c-.25 0-.5.05-.75.15L2 8.3V13h2V9.65l1.75-.75M13 2v7h3.75v14h1.5V9H22V2h-9zm5.01 6V6.25H14.5v-1.5h3.51V3l2.49 2.5L18.01 8z"}),"FollowTheSigns");let rt={text:n=>t("span",{children:n.children}),inline:n=>t("span",{children:n.children}),paragraph:n=>t("div",{children:n.children}),group:n=>t("div",{children:n.children}),struct:n=>t("div",{children:n.children}),support:n=>t("div",{children:n.children})};function nt(n,e){const r=e.normalizeNode;return e.normalizeNode=l=>{let[i,a]=l;if(Se("initializing")){r(l);return}if(a.length==0){let s=i,o=s.children.length;if(o==0||!P(s.children[0],"support","\u5C0F\u8282\u7EBF")){n.add_nodes(Pe.makenode(),[0]);return}if(!P(s.children[o-1],"support","\u7AE0\u8282\u7EBF")){n.add_nodes(De.makenode(),[o]);return}}if(P(i,"support","\u7AE0\u8282\u7EBF")&&(a.length!=1||a[0]!=e.children.length-1)){n.delete_node_by_path(a);return}r(l)},e}function it(n,e){const r=e.normalizeNode;let l=(i,a)=>{let s=A({},i),o=!1;for(let u in a)s[u]==null&&(s[u]=a[u],o=!0);for(let u in s)a[u]==null&&(delete s[u],o=!0);for(let u in s)s[u].type=="choice"&&JSON.stringify(s[u].choices)!=JSON.stringify(a[u].choices)&&(s[u]={val:s[u].val,type:"choice",choices:a[u].choices},o=!0);return[s,o]};return e.normalizeNode=i=>{let[a,s]=i;if(re(a)){let o=a,u=o.type,g=o.name,d=n.core.get_style(u,g);if(d==null){r(i);return}if(o.proxy_info&&o.proxy_info.proxy_name){let p=n.get_proxy(u,o.proxy_info.proxy_name),h=o.proxy_info.proxy_params||{},f=o.parameters||{},[_,y]=l(h,p.get_proxy_parameters({})),[F,E]=l(f,p.get_real_parameters(_));(y||E)&&n.set_node(o,{parameters:F,proxy_info:M(A({},o.proxy_info),{proxy_params:_})})}else{let p=o.parameters||{},[h,f]=l(p,d.parameter_prototype);f&&n.set_node(o,{parameters:h})}}r(i)},e}let ot=[nt,it];function at(n,e){for(let r of ot)e=r(n,e);return e}function lt(n){let[e,r]=c.useState(void 0),[l,i]=c.useState(!1),[a,s]=c.useState(!1);return m(c.Fragment,{children:[t(B,{title:"\u5220\u9664\u8D44\u6E90",icon:we,onClick:async o=>{r(o.currentTarget)}}),t(ie,{anchorEl:e,open:!!e,onClose:o=>r(void 0),anchorOrigin:{vertical:"center",horizontal:"right"},children:t(k,{onClick:async o=>{let u=await b.post.delete_resource(n.resource_id);s(u),i(!0),r(void 0),u&&n.onSuccess&&n.onSuccess()},children:"\u786E\u5B9A\uFF1F"})}),t(V,{info_sucess:"\u5220\u9664\u6210\u529F",info_fail:"\u5220\u9664\u5931\u8D25",open:l,status:a,onClose:()=>{i(!1)}})]})}function st(n){let[e,r,l]=[n.id,n.name,n.url],[i,a]=c.useState(r),[s,o]=c.useState(!1),[u,g]=c.useState(!1),[d,x]=c.useState(!1),[p,h]=c.useState(!1);$.exports.useEffect(()=>{a(r)},[r]);let f=n.onSuccess||(()=>{});return t(ze,{variant:"outlined",sx:{position:"relative",marginTop:"1rem",marginX:"1rem",marginBottom:"1rem",paddingY:"0.7rem"},children:m(C,{force_direction:"row",children:[t(v,{sx:{flex:1},children:m(C,{children:[t(L,{variant:"standard",label:"name",value:i,fullWidth:!0,onChange:_=>{a(_.target.value)}}),t(L,{variant:"standard",label:"url",value:l,fullWidth:!0,sx:{marginTop:"1rem"},InputProps:{readOnly:!0}})]})}),t(v,{children:m(C,{children:[t(B,{title:"\u66F4\u6539\u8D44\u6E90\u540D",icon:et,onClick:async _=>{let y={name:i},F=await b.post.manage_recourse(!1,y,e);x(F),o(!0)}}),m("label",{children:[t("input",{type:"file",style:{display:"none"},onChange:async _=>{if(_.target.files.length<=0)h(!1);else{var y=new FormData;y.append("file",_.target.files[0]);let F=await b.post.manage_recourse(!0,y,e);h(F),F&&f()}g(!0)}}),t(B,{title:"\u66FF\u6362\u6587\u4EF6",icon:ae,component:"span"})]}),t(lt,{resource_id:e,onSuccess:f})]})}),t(V,{info_sucess:"\u4FEE\u6539\u6587\u4EF6\u540D\u6210\u529F",info_fail:"\u4FEE\u6539\u6587\u4EF6\u540D\u5931\u8D25",open:s,status:d,onClose:()=>{o(!1)}}),t(V,{info_sucess:"\u4E0A\u4F20\u6587\u4EF6\u6210\u529F",info_fail:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",open:u,status:p,onClose:()=>{g(!1)}})]})})}class ut extends c.Component{constructor(e){super(e);this.state={resources:[]}}async effect(){let e=await b.get.resources();this.setState({resources:e}),this.forceUpdate()}async componentDidMount(){this.effect()}render(){let e=this;return t(v,{sx:r=>A({},r.printer.typography.body),children:t(C,{force_direction:"column",children:e.state.resources.map((r,l)=>{let[i,a,s]=r;return t(c.Fragment,{children:t(st,{id:i,name:a,url:s,onSuccess:()=>{e.effect()}})},l)})})})}}function ct(n){let[e,r]=c.useState(!1);return m(c.Fragment,{children:[t(O,{close_item:t(H,{title:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6",children:t(ne,{size:"small",children:t(ee,{fontSize:"small",color:"primary"})})}),open_item:t(k,{startIcon:t(ee,{}),color:"primary",children:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6"}),onClick:()=>{r(!0)},no_button:!0}),t(Ce,{anchor:"left",open:e,onClose:()=>r(!1),ModalProps:{keepMounted:!1},SlideProps:{onExited:()=>{}},PaperProps:{sx:{width:"40%"}},children:t(ut,{})})]})}function dt(n,e,r){function l(a,s){if(oe(a)){for(let d in a.children){let x=a.children[d];if(l(x,[...s,Number(d)]))return!0}return}let o=a.text,u=/([^\$]|^)(\$[^\$]+?\$)([^\$]|$)/.exec(o),g=/\$\$[^\$]+?\$\$/.exec(o);if(u){let d=u,x=d.index+d[1].length,p=d[2],h=d.index+d[1].length+p.length,f=o.slice(0,x),_=o.slice(h,o.length),y=p.slice(1,p.length-1),E=n.proxies.inline[e].makenode();return E.children=[{text:y}],n.delete_node_by_path(s),n.add_nodes([{text:f},E,{text:_}],s),!0}if(g){let d=g,x=d.index,p=d[0],h=d.index+p.length,f=o.slice(0,x),_=o.slice(h,o.length),y=p.slice(2,p.length-2),E=n.proxies.group[r].makenode();E.children=[{text:y}];let le=J(f),se=J(_);return n.delete_node_by_path(s),n.add_nodes([le,E,se],s),!0}return!1}let i=0;for(;l(n.get_root(),[]);)if(i++,i>0){console.log("\u592A\u591A\u6570\u5B66...");break}}function pt(n){const[e,r]=c.useState(null),[l,i]=c.useState("\u6570\u5B66-\u884C\u5185"),[a,s]=c.useState("\u6570\u5B66-\u5757");return m(c.Fragment,{children:[t(O,{close_item:t(H,{title:"\u5904\u7406\u6570\u5B66",children:t(ne,{size:"small",children:t(Z,{fontSize:"small",color:"primary"})})}),open_item:t(k,{startIcon:t(Z,{}),color:"primary",children:"\u5904\u7406\u6570\u5B66"}),onClick:o=>{r(o.currentTarget)},no_button:!0}),t(ie,{open:Boolean(e),anchorEl:e,onClose:()=>{r(void 0)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},sx:{paddingX:"4rem",paddingY:"2rem"},children:m(C,{force_direction:"column",children:[t(L,{label:"\u884C\u5185\u516C\u5F0F\u7684Style\u540D",defaultValue:l,InputProps:{startAdornment:t(Q,{position:"start",children:"$...$ = "})},sx:{marginBottom:"0.5rem",marginTop:"1rem"},onChange:o=>{i(o.target.value)}}),t(L,{label:"\u5757\u7EA7\u516C\u5F0F\u7684Style\u540D",defaultValue:a,InputProps:{startAdornment:t(Q,{position:"start",children:"$$...$$ = "})},sx:{marginY:"0.5rem"},onChange:o=>{s(o.target.value)}}),t(k,{variant:"outlined",sx:{width:"50%",marginX:"auto",marginY:"0.5rem"},onClick:()=>{dt(n.get_editor(),l,a)},children:"\u5F00\u59CB\uFF01"})]})})]})}function U(n){let e=n.Icon;return t(c.Fragment,{children:t(O,{close_item:t(v,{sx:{marginLeft:"0.2rem",marginTop:"0.35rem"},children:t(H,{title:n.title,children:t(X,{underline:"hover",href:n.href,children:t(e,{fontSize:"small",color:"primary"})})})}),open_item:t(v,{sx:{marginLeft:"0.2rem",marginTop:"0.2rem",marginBottom:"0.3rem"},children:t(X,{underline:"hover",href:n.href,children:m(C,{children:[t(e,{fontSize:"small",color:"primary"}),t(te,{sx:r=>M(A({},r.typography.button),{marginLeft:"0.5rem"}),children:n.title})]})})}),no_button:!0})})}function ht(n){return t(U,{title:"\u540E\u53F0\u9875\u9762",href:R(`/admin/articlezone/node/${w.node_id}/change/`),Icon:tt})}function _t(n){return t(U,{title:"\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:R(`/edit/structure/${w.node_id}`),Icon:Qe})}function mt(n){return t(U,{title:"\uFF08\u6D45\uFF09\u7F16\u8F91\u5B50\u8282\u70B9\u7ED3\u6784",href:R(`/edit/shallow_structure/${w.node_id}`),Icon:Ze})}class ft extends c.Component{constructor(e){super(e);S(this,"core");S(this,"editor_renderers");S(this,"printer_renderers");S(this,"printer_ref");S(this,"editor_ref");S(this,"savebutton_ref");this.core=$e(new Te([])),this.editor_renderers=Ne(new W(this.core,rt)),this.printer_renderers=Ve(new W(this.core,Ae)),this.state={editor_proxies:q({inline:{},group:{},struct:{},support:{},abstract:{}})},this.editor_ref=c.createRef(),this.printer_ref=c.createRef(),this.savebutton_ref=c.createRef()}set_proxy_params(e,r){function l(i){if(re(i)&&i.proxy_info&&i.proxy_info.proxy_name){let s=e.get_proxy(i.type,i.proxy_info.proxy_name).get_proxy_parameters(i.parameters);i.proxy_info.proxy_params=s}if(oe(i))for(let a of i.children)l(a)}return l(r),r}async componentDidMount(){let e=q({inline:{},group:{},struct:{},support:{},abstract:{}}),r=await b.get.concept();for(let[s,o,u,g]of r){let d=Oe(o,s,u,g);e[d.get_styletype()][s]=d}this.setState({editor_proxies:e});var l=await b.get.content();for(l=l||Me("root",{title:{val:"",type:"string"}}),Y({initializing:!0});!this.get_editor(););let i=this.get_editor();for(i.replace_nodes(i.get_root(),l.children),i.set_node(i.get_root(),{parameters:l.parameters,hiddens:l.hiddens}),this.editor_ref.current.forceUpdate(),Y({initializing:!1});!this.get_printer(););let a=this.get_printer();a.update(l),w.linkto&&w.linkto!="None"&&He(a,Number(w.linkto))}get_editor(){if(this.editor_ref&&this.editor_ref.current)return this.editor_ref.current.get_editor()}get_printer(){if(this.printer_ref&&this.printer_ref.current)return this.printer_ref.current.get_printer()}get_save_button(){if(this.savebutton_ref&&this.savebutton_ref.current)return this.savebutton_ref.current}async save_content(){let e=this.get_editor();if(e){var r={content:e.get_root()};return await b.post.content(r)}return!1}async post_file(e){var r=new FormData;return r.append("file",e[0]),await b.post.file(r)}update_printer(){let e=this.get_printer(),r=this.get_editor();!(e&&r)||e.update(r.get_root())}extra_buttons(e){let r=this;return t(c.Fragment,{children:t(v,{sx:{marginX:"auto"},children:m("label",{children:[t("input",{type:"file",style:{display:"none"},onChange:l=>{l.target.files.length>0&&r.post_file(l.target.files)}}),t(B,{title:"\u4E0A\u4F20",icon:ae,component:"span"})]})})})}mainpart(e){let r=this,l=this.extra_buttons.bind(this);return m(v,{sx:e.sx,children:[t(v,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:t(Le,{ref:r.editor_ref,core:r.core,renderers:r.editor_renderers,proxies:r.state.editor_proxies,theme:D,onFocusChange:()=>{let i=r.get_printer(),a=r.get_editor();i&&a&&a.get_slate().selection&&i.scroll_to(a.get_slate().selection.focus.path)},onUpdate:()=>{},onSave:()=>{r.update_printer();let i=r.get_save_button();i&&i.click()},extra_buttons:t(l,{}),plugin:at})}),t(v,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:t(Be,{ref:this.printer_ref,core:this.core,renderers:this.printer_renderers,theme:D})})]})}render(){let e=this,r=this.mainpart.bind(this);return t(ke,{theme:Ie(D),children:t(v,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:m(Re,{children:[m(Ue,{sx:{marginRight:"1%"},children:[t(je,{ref:e.savebutton_ref,save_func:e.save_content.bind(e)}),t(ct,{}),t(pt,{get_editor:()=>e.get_editor()}),t(ht,{}),t(_t,{}),t(mt,{})]}),t(r,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})})}}_e.render(t(c.StrictMode,{children:t(ft,{})}),document.getElementById("root"));
