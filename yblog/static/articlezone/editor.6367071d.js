var K=Object.defineProperty;var M=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var k=(n,e,t)=>e in n?K(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,y=(n,e)=>{for(var t in e||(e={}))L.call(e,t)&&k(n,t,e[t]);if(M)for(var t of M(e))Q.call(e,t)&&k(n,t,e[t]);return n};var A=(n,e,t)=>(k(n,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill.9d8db203.js";import{T as C,a as d,j as r,P as Z,b as m,B as b,c as S,D as ee,d as T,I as j,F as O,e as D,f as te,A as R,g as re,h as Y,i as ne,k as ae,R as se}from"./vendor.d26df5e7.js";import{i as z,a as le,s as ie,I as F,A as B,b as P,P as V,c as H,h as oe,d as X,e as U,p as $,E as ue,Y as ce,f as de,D as he,g as me}from"./snackbar.7bd280dc.js";import{s as pe,e as fe,w as _e,a as ge,b as xe,m as ye,c as I,M as be}from"./theme.74411e08.js";import{F as W,a as Fe,S as Ee}from"./buttons.81cb896d.js";var N={initializing:!1};function ve(n){N=y(y({},N),n)}function we(n){const e=n.slate.normalizeNode;return n.slate.normalizeNode=t=>{let[s,u]=t;if(N.initializing){e(t);return}if(u.length==0){let l=s,i=l.children.length;if(i==0||!z(l.children[0],"support","\u5C0F\u8282\u7EBF")){C.insertNodes(n.slate,pe.makenode(),{at:[0]});return}if(!z(l.children[i-1],"support","\u7AE0\u8282\u7EBF")){C.insertNodes(n.slate,fe.makenode(),{at:[i]});return}}if(z(s,"support","\u7AE0\u8282\u7EBF")&&(u.length!=1||u[0]!=n.slate.children.length-1)){C.removeNodes(n.slate,{at:u});return}e(t)},n}function Ce(n){const e=n.slate.normalizeNode;return n.slate.normalizeNode=t=>{let[s,u]=t;if(le(s)){let l=s,i=l.type,a=l.name,_=n.core.get_style(i,a);if(_==null){e(t);return}let p=_.parameter_prototype,o=y({},l.parameters),c=!1;for(let h of Object.keys(p))o[h]==null&&(o[h]=p[h],c=!0);if(c){ie(n,l,{parameters:o});return}}e(t)},n}let J=ve,Be=[we,Ce];function Se(n){for(let e of Be)n=e(n);return n}class ke extends d.Component{constructor(e){super(e);this.state={resources:[]}}async effect(){let e=await F.get.resources();this.setState({resources:e})}async componentDidMount(){this.effect()}SubCard(e){let t=this,[s,u,l]=[e.id,e.name,e.url],[i,a]=d.useState(e.name),[_,p]=d.useState(!1),[o,c]=d.useState(!1),[h,x]=d.useState(!1),[w,E]=d.useState(!1);return r(Z,{variant:"outlined",sx:{position:"relative",marginTop:"1rem",marginX:"1rem",marginBottom:"1rem",paddingY:"0.7rem"},children:m(B,{force_direction:"row",children:[r(b,{sx:{flex:1},children:m(B,{children:[r(S,{variant:"standard",label:"name",defaultValue:u,fullWidth:!0,onChange:g=>{a(g.target.value)}}),r(S,{variant:"standard",label:"url",defaultValue:l,fullWidth:!0,sx:{marginTop:"1rem"},InputProps:{readOnly:!0}})]})}),r(b,{children:m(B,{children:[r(P,{title:"\u66F4\u6539\u8D44\u6E90\u540D",icon:ee,onClick:async g=>{let v={name:i},f=await F.post.manage_recourse(!1,v,s);x(f),p(!0)}}),m("label",{children:[r("input",{type:"file",style:{display:"none"},onChange:async g=>{if(g.target.files.length<=0)E(!1);else{var v=new FormData;v.append("file",g.target.files[0]);let f=await F.post.manage_recourse(!0,v,s);E(f),f&&t.effect()}c(!0)}}),r(P,{title:"\u66FF\u6362\u6587\u4EF6",icon:T,component:"span"})]})]})}),r(V,{info_sucess:"\u4FEE\u6539\u6587\u4EF6\u540D\u6210\u529F",info_fail:"\u4FEE\u6539\u6587\u4EF6\u540D\u5931\u8D25",open:_,status:h,onClose:()=>{p(!1)}}),r(V,{info_sucess:"\u4E0A\u4F20\u6587\u4EF6\u6210\u529F",info_fail:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",open:o,status:w,onClose:()=>{c(!1)}})]})})}render(){let e=this;return r(b,{sx:t=>y({},t.printer.typography.body),children:r(B,{force_direction:"column",children:e.state.resources.map((t,s)=>{let[u,l,i]=t,a=e.SubCard.bind(e);return r(d.Fragment,{children:r(a,{id:u,name:l,url:i})},s)})})})}}function Ae(n){let[e,t]=d.useState(!1);return m(d.Fragment,{children:[r(W,{close_item:r(H,{title:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6",children:r(j,{size:"small",children:r(O,{fontSize:"small",color:"primary"})})}),open_item:r(D,{startIcon:r(O,{}),color:"primary",children:"\u67E5\u770B/\u7BA1\u7406\u6587\u4EF6"}),onClick:()=>{t(!0)},no_button:!0}),r(te,{anchor:"left",open:e,onClose:()=>t(!1),ModalProps:{keepMounted:!0},SlideProps:{onExited:()=>{}},PaperProps:{sx:{width:"40%"}},children:r(ke,{})})]})}function De(n,e,t){function s(l,i){if(oe(l)){for(let o in l.children){let c=l.children[o];if(s(c,[...i,Number(o)]))return!0}return}let a=l.text,_=/([^\$]|^)(\$[^\$]+?\$)([^\$]|$)/.exec(a),p=/\$\$[^\$]+?\$\$/.exec(a);if(_){let o=_,c=o.index+o[1].length,h=o[2],x=o.index+o[1].length+h.length,w=a.slice(0,c),E=a.slice(x,a.length),g=h.slice(1,h.length-1),f=n.core.get_style("inline",e).makenode();return f.children=[{text:g}],X(n,i),U(n,[{text:w},f,{text:E}],i),!0}if(p){let o=p,c=o.index,h=o[0],x=o.index+h.length,w=a.slice(0,c),E=a.slice(x,a.length),g=h.slice(2,h.length-2),f=n.core.get_style("group",t).makenode();f.children=[{text:g}];let q=$(w),G=$(E);return X(n,i),U(n,[q,f,G],i),!0}return!1}let u=0;for(;s(n.slate,[]);)if(u++,console.log(n.core.root),u>100){console.log("\u592A\u591A\u6570\u5B66...");break}}function ze(n){const[e,t]=d.useState(null),[s,u]=d.useState("\u6570\u5B66-\u884C\u5185"),[l,i]=d.useState("\u6570\u5B66-\u5757");return m(d.Fragment,{children:[r(W,{close_item:r(H,{title:"\u5904\u7406\u6570\u5B66",children:r(j,{size:"small",children:r(R,{fontSize:"small",color:"primary"})})}),open_item:r(D,{startIcon:r(R,{}),color:"primary",children:"\u5904\u7406\u6570\u5B66"}),onClick:a=>{t(a.currentTarget)},no_button:!0}),r(re,{open:Boolean(e),anchorEl:e,onClose:()=>{t(void 0)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},sx:{paddingX:"4rem",paddingY:"2rem"},children:m(B,{force_direction:"column",children:[r(S,{label:"\u884C\u5185\u516C\u5F0F\u7684Style\u540D",defaultValue:s,InputProps:{startAdornment:r(Y,{position:"start",children:"$...$ = "})},sx:{marginBottom:"0.5rem",marginTop:"1rem"},onChange:a=>{u(a.target.value)}}),r(S,{label:"\u5757\u7EA7\u516C\u5F0F\u7684Style\u540D",defaultValue:l,InputProps:{startAdornment:r(Y,{position:"start",children:"$$...$$ = "})},sx:{marginY:"0.5rem"},onChange:a=>{i(a.target.value)}}),r(D,{variant:"outlined",sx:{width:"50%",marginX:"auto",marginY:"0.5rem"},onClick:()=>{De(n.editor,s,l)},children:"\u5F00\u59CB\uFF01"})]})})]})}class Pe extends d.Component{constructor(e){super(e);A(this,"core");A(this,"printer_ref");this.core=_e(new ue([],{title:""})),this.state={editor:Se(ge(new ce(this.core))),printer:xe(new de(this.core))},this.printer_ref=d.createRef()}async componentDidMount(){let e=this.state.editor,t=this.state.printer,s=await F.get.concept();for(let[i,a,_,p,o]of s){let[c,h,x]=ye(a,i,_,p,o);this.core.add_style(c),c.type!="abstract"&&(e.update_renderer(h,c.type,c.name),t.update_renderer(x,c.type,c.name))}this.setState({editor:e,printer:t});var u=await F.get.content();u=u||{children:[$("")],parameters:{}},J({initializing:!0});let l=this.state.editor.slate.children.map((i,a)=>Number(a));C.removeNodes(this.state.editor.slate,{at:l}),C.insertNodes(this.state.editor.slate,u.children,{at:[0]}),this.core.update_root({parameters:y(y({},this.core.root.parameters),u.parameters)}),J({initializing:!1})}async save_content(){var e={content:this.core.root};return await F.post.content(e)}async post_file(e){var t=new FormData;return t.append("file",e[0]),await F.post.file(t)}extra_buttons(e){let t=this;return r(d.Fragment,{children:m("label",{children:[r("input",{type:"file",style:{display:"none"},onChange:s=>{s.target.files.length>0&&t.post_file(s.target.files)}}),r(P,{title:"\u4E0A\u4F20",icon:T,component:"span"})]})})}mainpart(e){let t=this,s=this.extra_buttons.bind(this);return m(b,{sx:e.sx,children:[r(b,{sx:{position:"absolute",width:"49%",left:"0%",top:"0",height:"100%"},children:r(he,{editor:t.state.editor,theme:I,onFocusChange:()=>{t.state.editor.slate.selection&&t.printer_ref&&t.printer_ref.current&&t.printer_ref.current.scroll_to(t.state.editor.slate.selection.focus.path)},onUpdate:()=>{},extra_buttons:r(s,{})})}),r(b,{sx:{position:"absolute",width:"49%",left:"51%",top:"0",height:"100%"},children:r(me,{printer:t.state.printer,ref:this.printer_ref,theme:I})})]})}render(){let e=this,t=this.mainpart.bind(this);return r(ne,{theme:ae(I),children:r(b,{sx:{position:"absolute",top:"2%",left:"1%",height:"96%",width:"98%",display:"flex"},children:m(be,{children:[m(Fe,{sx:{marginRight:"1%"},children:[r(Ee,{save_func:e.save_content.bind(e)}),r(Ae,{}),r(ze,{editor:e.state.editor})]}),r(t,{sx:{position:"relative",width:"100%",height:"100%",flex:1}})]})})})}}se.render(r(d.StrictMode,{children:r(Pe,{})}),document.getElementById("root"));
